{"version":3,"file":"point-of-sale.min.js","sources":["../../../apps/erpnext/node_modules/onscan.js/onscan.js","../../../apps/erpnext/erpnext/selling/page/point_of_sale/pos_item_selector.js","../../../apps/erpnext/erpnext/selling/page/point_of_sale/pos_item_cart.js","../../../apps/erpnext/erpnext/selling/page/point_of_sale/pos_item_details.js","../../../apps/erpnext/erpnext/selling/page/point_of_sale/pos_number_pad.js","../../../apps/erpnext/erpnext/selling/page/point_of_sale/pos_payment.js","../../../apps/erpnext/erpnext/selling/page/point_of_sale/pos_past_order_list.js","../../../apps/erpnext/erpnext/selling/page/point_of_sale/pos_past_order_summary.js","../../../apps/erpnext/erpnext/selling/page/point_of_sale/pos_controller.js"],"sourcesContent":["/*\n * onScan.js - scan-events for hardware barcodes scanners in javascript\n */\n;(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory()) :\n    global.onScan = factory()\n}(this, (function () {\n\tvar onScan = {\t\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tattachTo: function(oDomElement, oOptions) {\n\t\n\t\t\tif(oDomElement.scannerDetectionData !== undefined){\n\t\t\t\tthrow new Error(\"onScan.js is already initialized for DOM element \" + oDomElement);\n\t\t\t}\n\t\n\t\t\tvar oDefaults = {\n\t\t\t\tonScan: function(sScanned, iQty){}, // Callback after detection of a successfull scanning:  function(){sScancode, iCount)}()\n\t\t\t\tonScanError: function(oDebug){}, // Callback after detection of a unsuccessfull scanning (scanned string in parameter)\n\t\t\t\tonKeyProcess: function(sChar, oEvent){}, // Callback after receiving and processing a char (scanned char in parameter)\n\t\t\t\tonKeyDetect: function(iKeyCode, oEvent){}, // Callback after detecting a keyDown (key char in parameter) - in contrast to onKeyProcess, this fires for non-character keys like tab, arrows, etc. too!\n\t\t\t\tonPaste: function(sPasted, oEvent){}, // Callback after receiving a value on paste, no matter if it is a valid code or not\n\t\t\t\tkeyCodeMapper: function(oEvent) {return onScan.decodeKeyEvent(oEvent)}, // Custom function to decode a keydown event into a character. Must return decoded character or NULL if the given event should not be processed.\n\t\t\t\tonScanButtonLongPress: function(){}, // Callback after detection of a successfull scan while the scan button was pressed and held down\n\t\t\t\tscanButtonKeyCode:false, // Key code of the scanner hardware button (if the scanner button a acts as a key itself) \n\t\t\t\tscanButtonLongPressTime:500, // How long (ms) the hardware button should be pressed, until a callback gets executed\n\t\t\t\ttimeBeforeScanTest:100, // Wait duration (ms) after keypress event to check if scanning is finished\n\t\t\t\tavgTimeByChar:30, // Average time (ms) between 2 chars. Used to do difference between keyboard typing and scanning\n\t\t\t\tminLength:6, // Minimum length for a scanning\n\t\t\t\tsuffixKeyCodes:[9,13], // Chars to remove and means end of scanning\n\t\t\t\tprefixKeyCodes:[], // Chars to remove and means start of scanning\n\t\t\t\tignoreIfFocusOn:false, // do not handle scans if the currently focused element matches this selector or object\n\t\t\t\tstopPropagation:false, // Stop immediate propagation on keypress event\n\t\t\t\tpreventDefault:false, // Prevent default action on keypress event\n\t\t\t\tcaptureEvents:false, // Get the events before any listeners deeper in the DOM\n\t\t\t\treactToKeydown:true, // look for scan input in keyboard events\n\t\t\t\treactToPaste:false, // look for scan input in paste events\n\t\t\t\tsingleScanQty: 1, // Quantity of Items put out to onScan in a single scan\n\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\toOptions = this._mergeOptions(oDefaults, oOptions);\n\t\n\t\t\t// initializing options and variables on DomElement\n\t\t\toDomElement.scannerDetectionData = {\n\t\t\t\t\toptions: oOptions,\n\t\t\t\t\tvars:{\n\t\t\t\t\t\tfirstCharTime: 0,\n\t\t\t\t\t\tlastCharTime: 0,\n\t\t\t\t\t\taccumulatedString: '',\n\t\t\t\t\t\ttestTimer: false,\n\t\t\t\t\t\tlongPressTimeStart: 0,\n\t\t\t\t\t\tlongPressed: false\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t};\n\t\t\t\n\t\t\t// initializing handlers (based on settings)\n\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.reactToKeydown === true || oOptions.scanButtonKeyCode !== false){\t\n\t\t\t\toDomElement.addEventListener(\"keydown\", this._handleKeyDown, oOptions.captureEvents);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\tdetachFrom: function(oDomElement) {\n\t\t\t// detaching all used events\n\t\t\tif (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t}\n\t\t\tif (oDomElement.scannerDetectionData.options.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t}\n\t\t\toDomElement.removeEventListener(\"keydown\", this._handleKeyDown);\n\t\t\t\n\t\t\t// clearing data off DomElement\n\t\t\toDomElement.scannerDetectionData = undefined; \n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return Object\n\t\t */\n\t\tgetOptions: function(oDomElement){\n\t\t\treturn oDomElement.scannerDetectionData.options;\t\t\t\n\t\t},\n\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tsetOptions: function(oDomElement, oOptions){\n\t\t\t// check if some handlers need to be changed based on possible option changes\n\t\t\tswitch (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\tcase true: \n\t\t\t\t\tif (oOptions.reactToPaste === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tswitch (oDomElement.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault: \n\t\t\t\t\tif (oOptions.scanButtonKeyCode === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\t// merge old and new options\n\t\t\toDomElement.scannerDetectionData.options = this._mergeOptions(oDomElement.scannerDetectionData.options, oOptions);\n\t\t\n\t\t\t// reinitiallize\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Transforms key codes into characters.\n\t\t * \n\t\t * By default, only the follwing key codes are taken into account\n\t\t * - 48-90 (letters and regular numbers)\n\t\t * - 96-105 (numeric keypad numbers)\n\t\t * - 106-111 (numeric keypad operations)\n\t\t * \n\t\t * All other keys will yield empty strings!\n\t\t * \n\t\t * The above keycodes will be decoded using the KeyboardEvent.key property on modern\n\t\t * browsers. On older browsers the method will fall back to String.fromCharCode()\n\t\t * putting the result to upper/lower case depending on KeyboardEvent.shiftKey if\n\t\t * it is set.\n\t\t * \n\t\t * @param KeyboardEvent oEvent\n\t\t * @return string\n\t\t */\n\t\tdecodeKeyEvent : function (oEvent) {\n\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\tswitch (true) {\n\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== '') {\n\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\tcase false: sDecoded = sDecoded.toLowerCase(); break;\n\t\t\t\t\t\tcase true: sDecoded = sDecoded.toUpperCase(); break;\n\t\t\t\t\t}\n\t\t\t\t\treturn sDecoded;\n\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\treturn 0+(iCode-96);\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\t\n\t\t/**\n\t\t * Simulates a scan of the provided code.\n\t     *\n\t\t * The scan code can be defined as\n\t\t * - a string - in this case no keyCode decoding is done and the code is merely validated\n\t\t * against constraints like minLenght, etc.\n\t\t * - an array of keyCodes (e.g. `[70,71,80]`) - will produce `keydown` events with corresponding\n\t\t * `keyCode` properties. NOTE: these events will have empty `key` properties, so decoding may\n\t\t * yield different results than with native events.\n\t\t * - an array of objects (e.g. `[{keyCode: 70, key: \"F\", shiftKey: true}, {keyCode: 71, key: \"g\"}]`) -\n\t\t * this way almost any event can be simulated, but it's a lot of work to do.\n\t\t *\n\t\t * @param DomElement oDomElement\n\t\t * @param string|array mStringOrArray\n\t\t * @return self\n\t\t */\n\t\tsimulate: function(oDomElement, mStringOrArray){\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\tif (Array.isArray(mStringOrArray)){\n\t\t\t\tmStringOrArray.forEach(function(mKey){\n\t\t\t\t\tvar oEventProps = {};\n\t\t\t\t\tif( (typeof mKey === \"object\" || typeof mKey === 'function') && (mKey !== null) ) {\n\t\t\t\t\t\toEventProps = mKey;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toEventProps.keyCode = parseInt(mKey);\n\t\t\t\t\t}\n\t\t\t\t\tvar oEvent = new KeyboardEvent('keydown', oEventProps);\n\t\t\t\t\tdocument.dispatchEvent(oEvent);\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis._validateScanCode(oDomElement, mStringOrArray);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\t_reinitialize: function(oDomElement){\n\t\t\tvar oVars = oDomElement.scannerDetectionData.vars;\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\toVars.accumulatedString = '';\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t     * @return boolean\n\t\t */\n\t\t_isFocusOnIgnoredElement: function(oDomElement){\n\t\t\t\n\t\t\tvar ignoreSelectors = oDomElement.scannerDetectionData.options.ignoreIfFocusOn;\n\t\n\t        if(!ignoreSelectors){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\n\t\t\tvar oFocused = document.activeElement;\n\t\t\t\n\t\t\t// checks if ignored element is an array, and if so it checks if one of the elements of it is an active one\n\t\t\tif (Array.isArray(ignoreSelectors)){\n\t\t\t\tfor(var i=0; i<ignoreSelectors.length; i++){\n\t\t\t\t\tif(oFocused.matches(ignoreSelectors[i]) === true){\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t// if the option consists of an single element, it only checks this one\n\t\t\t} else if (oFocused.matches(ignoreSelectors)){\n\t\t\t\treturn true;\t\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// if the active element is not listed in the ignoreIfFocusOn option, return false\n\t\t    return false;\n\t    },\n\t\t\n\t    /**\n\t     * Validates the scan code accumulated by the given DOM element and fires the respective events.\n\t     * \n\t     * @private\n\t     * @param DomElement oDomElement\n\t     * @return boolean\n\t     */\n\t\t_validateScanCode: function(oDomElement, sScanCode){\n\t\t\tvar oScannerData = oDomElement.scannerDetectionData;\t\t\t\n\t\t\tvar oOptions = oScannerData.options;\n\t\t\tvar iSingleScanQty = oScannerData.options.singleScanQty;\n\t\t\tvar iFirstCharTime = oScannerData.vars.firstCharTime;\n\t\t\tvar iLastCharTime = oScannerData.vars.lastCharTime;\n\t\t\tvar oScanError = {};\n\t        var oEvent;\n\t        \n\t\t\tswitch(true){\n\t\t\t\t\n\t\t\t\t// detect codes that are too short\n\t\t\t\tcase (sScanCode.length < oOptions.minLength):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code is shorter then minimal length\"\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// detect codes that were entered too slow\t\n\t\t\t\tcase ((iLastCharTime - iFirstCharTime) > (sScanCode.length * oOptions.avgTimeByChar)):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code was not entered in time\"\n\t\t\t\t\t};\t\t\t\t\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// if a code was not filtered out earlier it is valid\t\n\t\t\t\tdefault:\n\t\t\t\t\toOptions.onScan.call(oDomElement, sScanCode, iSingleScanQty);\n\t\t\t\t\toEvent = new CustomEvent(\n\t\t\t\t\t\t'scan',\n\t\t\t\t\t\t{\t\n\t\t\t\t\t\t\tdetail: { \n\t\t\t\t\t\t\t\tscanCode: sScanCode,\n\t\t\t\t\t\t\t\tqty: iSingleScanQty\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\t\tonScan._reinitialize(oDomElement);\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\t// If an error occurred (otherwise the method would return earlier) create an object for errordetection\n\t\t\toScanError.scanCode = sScanCode;\n\t\t\toScanError.scanDuration = iLastCharTime - iFirstCharTime;\n\t\t\toScanError.avgTimeByChar = oOptions.avgTimeByChar;\n\t\t\toScanError.minLength = oOptions.minLength;\n\t\t\t\n\t\t\toOptions.onScanError.call(oDomElement, oScanError);\n\t\t\t\n\t\t\toEvent = new CustomEvent(\n\t\t\t\t'scanError', \n\t\t\t\t{detail: oScanError}\n\t\t\t);\n\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\n\t\t\tonScan._reinitialize(oDomElement);\n\t\t\treturn false;\n\t    },\n\t\n\t    /**\n\t     * @private\n\t     * @param Object oDefaults\n\t     * @param Object oOptions\n\t     * @return Object\n\t     */\n\t\t_mergeOptions: function(oDefaults, oOptions){\n\t\t\tvar oExtended = {};\n\t\t\tvar prop;\n\t\t\tfor (prop in oDefaults){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oDefaults, prop)){\n\t\t\t\t\toExtended[prop] = oDefaults[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\tfor (prop in oOptions){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oOptions, prop)){\n\t\t\t\t\toExtended[prop] = oOptions[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\treturn oExtended;\n\t\t},\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return int\n\t\t * @see https://www.w3schools.com/jsref/event_key_keycode.asp\n\t\t */\n\t\t_getNormalizedKeyNum: function(e){\n\t\t\treturn e.which || e.keyCode;\n\t\t},\n\t\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyDown: function(e){\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar bScanFinished = false;\n\t\t\t\n\t\t\tif (oOptions.onKeyDetect.call(this, iKeyCode, e) === false) {\n\t\t\t\treturn;\n\t\t\t}\t\t\n\t\t\t\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\t\t\t\n\t        // If it's just the button of the scanner, ignore it and wait for the real input\n\t\t    if(oOptions.scanButtonKeyCode !== false && iKeyCode==oOptions.scanButtonKeyCode) {\n\t\t\t\t\n\t\t\t\t// if the button was first pressed, start a timeout for the callback, which gets interrupted if the scanbutton gets released\n\t\t\t\tif (!oVars.longPressed){\n\t\t\t\t\toVars.longPressTimer = setTimeout( oOptions.onScanButtonLongPress, oOptions.scanButtonLongPressTime, this);\n\t\t\t\t\toVars.longPressed = true;\n\t\t\t\t}\n\t\n\t\t\t\treturn;\n\t        }\n\t\t\t\n\t\t\tswitch(true){\n\t\t\t\t// If it's not the first character and we encounter a terminating character, trigger scan process\n\t\t\t\tcase (oVars.firstCharTime && oOptions.suffixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=true;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// If it's the first character and we encountered one of the starting characters, don't process the scan\t\n\t\t\t\tcase (!oVars.firstCharTime && oOptions.prefixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// Otherwise, just add the character to the scan string we're building\t\n\t\t\t\tdefault:\n\t\t\t\t\tvar character = oOptions.keyCodeMapper.call(this, e);\n\t\t\t\t\tif (character === null){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\toVars.accumulatedString += character;\n\t\t\t\t\t\n\t\t\t\t\tif (oOptions.preventDefault) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t        \n\t\t\tif(!oVars.firstCharTime){\n\t\t\t\toVars.firstCharTime=Date.now();\n\t\t\t}\n\t\t\t\n\t\t\toVars.lastCharTime=Date.now();\n\t\n\t\t\tif(oVars.testTimer){ \n\t\t\t\tclearTimeout(oVars.testTimer);\n\t\t\t}\n\t\t\t\n\t\t\tif(bScanFinished){\n\t\t\t\tonScan._validateScanCode(this, oVars.accumulatedString);\n\t\t\t\toVars.testTimer=false;\n\t\t\t} else {\n\t\t\t\toVars.testTimer=setTimeout(onScan._validateScanCode, oOptions.timeBeforeScanTest, this, oVars.accumulatedString);\n\t\t\t}\n\t\n\t\t\toOptions.onKeyProcess.call(this, character, e);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param Event e\n\t\t * @return void\n\t\t */\n\t\t_handlePaste: function(e){\n\t\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar sPasteString = (event.clipboardData || window.clipboardData).getData('text');\n\t\t\t\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\te.preventDefault();\n\n\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}\n\t\t\t\t\t\t\n\t\t\toOptions.onPaste.call(this, sPasteString, event);\n\t\t\t\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\t\n\t\t\t// validate the string\n\t\t\tonScan._validateScanCode(this, sPasteString);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyUp: function(e){\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\t\n\t\t\t// if hardware key is not being pressed anymore stop the timeout and reset\n\t\t\tif (iKeyCode == this.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tclearTimeout(this.scannerDetectionData.vars.longPressTimer);\n\t\t\t\tthis.scannerDetectionData.vars.longPressed = false;\n\t\t\t}\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE the scanner is currently in the middle of a scan sequence.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisScanInProgressFor: function(oDomElement) {\n\t\t\treturn oDomElement.scannerDetectionData.vars.firstCharTime > 0;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE if onScan is attached to the given DOM element and FALSE otherwise.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisAttachedTo: function(oDomElement) {\n\t\t\treturn (oDomElement.scannerDetectionData !== undefined);\n\t\t}\n\t};\n\t\n\treturn onScan;\n})));","import onScan from 'onscan.js';\n\nerpnext.PointOfSale.ItemSelector = class {\n\t// eslint-disable-next-line no-unused-vars\n\tconstructor({ frm, wrapper, events, pos_profile, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.pos_profile = pos_profile;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.auto_add_item = settings.auto_add_item_to_cart;\n\n\t\tthis.inti_component();\n\t}\n\n\tinti_component() {\n\t\tthis.prepare_dom();\n\t\tthis.make_search_bar();\n\t\tthis.load_items_data();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"items-selector\">\n\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t<div class=\"label\">All Items</div>\n\t\t\t\t\t<div class=\"search-field\"></div>\n\t\t\t\t\t<div class=\"item-group-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"items-container\"></div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.items-selector');\n\t\tthis.$items_container = this.$component.find('.items-container');\n\t}\n\n\tasync load_items_data() {\n\t\tif (!this.item_group) {\n\t\t\tconst res = await frappe.db.get_value(\"Item Group\", {lft: 1, is_group: 1}, \"name\");\n\t\t\tthis.parent_item_group = res.message.name;\n\t\t}\n\t\tif (!this.price_list) {\n\t\t\tconst res = await frappe.db.get_value(\"POS Profile\", this.pos_profile, \"selling_price_list\");\n\t\t\tthis.price_list = res.message.selling_price_list;\n\t\t}\n\n\t\tthis.get_items({}).then(({message}) => {\n\t\t\tthis.render_item_list(message.items);\n\t\t});\n\t}\n\n\tget_items({start = 0, page_length = 40, search_term=''}) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst price_list = (doc && doc.selling_price_list) || this.price_list;\n\t\tlet { item_group, pos_profile } = this;\n\n\t\t!item_group && (item_group = this.parent_item_group);\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_items\",\n\t\t\tfreeze: true,\n\t\t\targs: { start, page_length, price_list, item_group, search_term, pos_profile },\n\t\t});\n\t}\n\n\n\trender_item_list(items) {\n\t\tthis.$items_container.html('');\n\n\t\titems.forEach(item => {\n\t\t\tconst item_html = this.get_item_html(item);\n\t\t\tthis.$items_container.append(item_html);\n\t\t});\n\t}\n\n\tget_item_html(item) {\n\t\tconst me = this;\n\t\t// eslint-disable-next-line no-unused-vars\n\t\tconst { item_image, serial_no, batch_no, barcode, actual_qty, stock_uom, price_list_rate } = item;\n\t\tconst indicator_color = actual_qty > 10 ? \"green\" : actual_qty <= 0 ? \"red\" : \"orange\";\n\t\tconst precision = flt(price_list_rate, 2) % 1 != 0 ? 2 : 0;\n\n\t\tlet qty_to_display = actual_qty;\n\n\t\tif (Math.round(qty_to_display) > 999) {\n\t\t\tqty_to_display = Math.round(qty_to_display)/1000;\n\t\t\tqty_to_display = qty_to_display.toFixed(1) + 'K';\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tif (!me.hide_images && item_image) {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\">${qty_to_display}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-center justify-center h-32 border-b-grey text-6xl text-grey-100\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tonerror=\"cur_pos.item_selector.handle_broken_image(this)\"\n\t\t\t\t\t\t\t\tclass=\"h-full\" src=\"${item_image}\"\n\t\t\t\t\t\t\t\talt=\"${frappe.get_abbr(item.item_name)}\"\n\t\t\t\t\t\t\t\tstyle=\"object-fit: cover;\">\n\t\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\">${qty_to_display}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-display abbr\">${frappe.get_abbr(item.item_name)}</div>`;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t`<div class=\"item-wrapper\"\n\t\t\t\tdata-item-code=\"${escape(item.item_code)}\" data-serial-no=\"${escape(serial_no)}\"\n\t\t\t\tdata-batch-no=\"${escape(batch_no)}\" data-uom=\"${escape(stock_uom)}\"\n\t\t\t\tdata-rate=\"${escape(price_list_rate)}\"\n\t\t\t\ttitle=\"${item.item_name}\">\n\n\t\t\t\t${get_item_image_html()}\n\n\t\t\t\t<div class=\"item-detail\">\n\t\t\t\t\t<div class=\"item-name\">\n\t\t\t\t\t\t${frappe.ellipsis(item.item_name, 18)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"item-rate\">${format_currency(price_list_rate, item.currency, precision) || 0}</div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).parent().replaceWith(`<div class=\"item-display abbr\">${item_abbr}</div>`);\n\t}\n\n\tmake_search_bar() {\n\t\tconst me = this;\n\t\tconst doc = me.events.get_frm().doc;\n\t\tthis.$component.find('.search-field').html('');\n\t\tthis.$component.find('.item-group-field').html('');\n\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Search'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: __('Search by item code, serial number or barcode')\n\t\t\t},\n\t\t\tparent: this.$component.find('.search-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.item_group_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Item Group'),\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\toptions: 'Item Group',\n\t\t\t\tplaceholder: __('Select item group'),\n\t\t\t\tonchange: function() {\n\t\t\t\t\tme.item_group = this.value;\n\t\t\t\t\t!me.item_group && (me.item_group = me.parent_item_group);\n\t\t\t\t\tme.filter_items();\n\t\t\t\t},\n\t\t\t\tget_query: function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery: 'erpnext.selling.page.point_of_sale.point_of_sale.item_group_query',\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tpos_profile: doc ? doc.pos_profile : ''\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$component.find('.item-group-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.item_group_field.toggle_label(false);\n\t}\n\n\tset_search_value(value) {\n\t\t$(this.search_field.$input[0]).val(value).trigger(\"input\");\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\twindow.onScan = onScan;\n\n\t\tonScan.decodeKeyEvent = function (oEvent) {\n\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\tswitch (true) {\n\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\tcase (iCode >= 160 && iCode <= 164) || iCode == 170: // ^ ! # $ *\n\t\t\t\tcase iCode >= 186 && iCode <= 194: // (; = , - . / `)\n\t\t\t\tcase iCode >= 219 && iCode <= 222: // ([ \\ ] ')\n\t\t\t\tcase iCode == 32: // spacebar\n\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== '') {\n\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\tcase false: sDecoded = sDecoded.toLowerCase(); break;\n\t\t\t\t\t\tcase true: sDecoded = sDecoded.toUpperCase(); break;\n\t\t\t\t\t}\n\t\t\t\t\treturn sDecoded;\n\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\treturn 0 + (iCode - 96);\n\t\t\t}\n\t\t\treturn '';\n\t\t};\n\n\t\tonScan.attachTo(document, {\n\t\t\tonScan: (sScancode) => {\n\t\t\t\tif (this.search_field && this.$component.is(':visible')) {\n\t\t\t\t\tthis.search_field.set_focus();\n\t\t\t\t\tthis.set_search_value(sScancode);\n\t\t\t\t\tthis.barcode_scanned = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.$component.on('click', '.item-wrapper', function() {\n\t\t\tconst $item = $(this);\n\t\t\tconst item_code = unescape($item.attr('data-item-code'));\n\t\t\tlet batch_no = unescape($item.attr('data-batch-no'));\n\t\t\tlet serial_no = unescape($item.attr('data-serial-no'));\n\t\t\tlet uom = unescape($item.attr('data-uom'));\n\t\t\tlet rate = unescape($item.attr('data-rate'));\n\n\t\t\t// escape(undefined) returns \"undefined\" then unescape returns \"undefined\"\n\t\t\tbatch_no = batch_no === \"undefined\" ? undefined : batch_no;\n\t\t\tserial_no = serial_no === \"undefined\" ? undefined : serial_no;\n\t\t\tuom = uom === \"undefined\" ? undefined : uom;\n\t\t\trate = rate === \"undefined\" ? undefined : rate;\n\n\t\t\tme.events.item_selected({\n\t\t\t\tfield: 'qty',\n\t\t\t\tvalue: \"+1\",\n\t\t\t\titem: { item_code, batch_no, serial_no, uom, rate }\n\t\t\t});\n\t\t\tme.set_search_value('');\n\t\t});\n\n\t\tthis.search_field.$input.on('input', (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.filter_items({ search_term });\n\t\t\t}, 300);\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '⌘' : 'Ctrl';\n\t\tthis.search_field.parent.attr(\"title\", `${ctrl_label}+I`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+i\",\n\t\t\taction: () => this.search_field.set_focus(),\n\t\t\tcondition: () => this.$component.is(':visible'),\n\t\t\tdescription: __(\"Focus on search input\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.item_group_field.parent.attr(\"title\", `${ctrl_label}+G`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+g\",\n\t\t\taction: () => this.item_group_field.set_focus(),\n\t\t\tcondition: () => this.$component.is(':visible'),\n\t\t\tdescription: __(\"Focus on Item Group filter\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\n\t\t// for selecting the last filtered item on search\n\t\tfrappe.ui.keys.on(\"enter\", () => {\n\t\t\tconst selector_is_visible = this.$component.is(':visible');\n\t\t\tif (!selector_is_visible || this.search_field.get_value() === \"\") return;\n\n\t\t\tif (this.items.length == 1) {\n\t\t\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t$(this.search_field.$input[0]).val(\"\").trigger(\"input\");\n\t\t\t} else if (this.items.length == 0 && this.barcode_scanned) {\n\t\t\t\t// only show alert of barcode is scanned and enter is pressed\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"No items found. Scan barcode again.\"),\n\t\t\t\t\tindicator: 'orange'\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\tthis.barcode_scanned = false;\n\t\t\t\t$(this.search_field.$input[0]).val(\"\").trigger(\"input\");\n\t\t\t}\n\t\t});\n\t}\n\n\tfilter_items({ search_term='' }={}) {\n\t\tif (search_term) {\n\t\t\tsearch_term = search_term.toLowerCase();\n\n\t\t\t// memoize\n\t\t\tthis.search_index = this.search_index || {};\n\t\t\tif (this.search_index[search_term]) {\n\t\t\t\tconst items = this.search_index[search_term];\n\t\t\t\tthis.items = items;\n\t\t\t\tthis.render_item_list(items);\n\t\t\t\tthis.auto_add_item && this.items.length == 1 && this.add_filtered_item_to_cart();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.get_items({ search_term })\n\t\t\t.then(({ message }) => {\n\t\t\t\t// eslint-disable-next-line no-unused-vars\n\t\t\t\tconst { items, serial_no, batch_no, barcode } = message;\n\t\t\t\tif (search_term && !barcode) {\n\t\t\t\t\tthis.search_index[search_term] = items;\n\t\t\t\t}\n\t\t\t\tthis.items = items;\n\t\t\t\tthis.render_item_list(items);\n\t\t\t\tthis.auto_add_item && this.items.length == 1 && this.add_filtered_item_to_cart();\n\t\t\t});\n\t}\n\n\tadd_filtered_item_to_cart() {\n\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t}\n\n\tresize_selector(minimize) {\n\t\tminimize ?\n\t\t\tthis.$component.find('.filter-section').css('grid-template-columns', 'repeat(1, minmax(0, 1fr))') :\n\t\t\tthis.$component.find('.filter-section').css('grid-template-columns', 'repeat(12, minmax(0, 1fr))');\n\n\t\tminimize ?\n\t\t\tthis.$component.find('.search-field').css('margin', 'var(--margin-sm) 0px') :\n\t\t\tthis.$component.find('.search-field').css('margin', '0px var(--margin-sm)');\n\n\t\tminimize ?\n\t\t\tthis.$component.css('grid-column', 'span 2 / span 2') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tminimize ?\n\t\t\tthis.$items_container.css('grid-template-columns', 'repeat(1, minmax(0, 1fr))') :\n\t\t\tthis.$items_container.css('grid-template-columns', 'repeat(4, minmax(0, 1fr))');\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n};\n","erpnext.PointOfSale.ItemCart = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.customer_info = undefined;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allowed_customer_groups = settings.customer_groups;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"customer-cart-container\"></section>`\n\t\t)\n\n\t\tthis.$component = this.wrapper.find('.customer-cart-container');\n\t}\n\n\tinit_child_components() {\n\t\tthis.init_customer_selector();\n\t\tthis.init_cart_components();\n\t}\n\n\tinit_customer_selector() {\n\t\tthis.$component.append(\n\t\t\t`<div class=\"customer-section\"></div>`\n\t\t)\n\t\tthis.$customer_section = this.$component.find('.customer-section');\n\t\tthis.make_customer_selector();\n\t}\n\n\treset_customer_selector() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrm.set_value('customer', '');\n\t\tthis.make_customer_selector();\n\t\tthis.customer_field.set_focus();\n\t}\n\n\tinit_cart_components() {\n\t\tthis.$component.append(\n\t\t\t`<div class=\"cart-container\">\n\t\t\t\t<div class=\"abs-cart-container\">\n\t\t\t\t\t<div class=\"cart-label\">Item Cart</div>\n\t\t\t\t\t<div class=\"cart-header\">\n\t\t\t\t\t\t<div class=\"name-header\">Item</div>\n\t\t\t\t\t\t<div class=\"qty-header\">Qty</div>\n\t\t\t\t\t\t<div class=\"rate-amount-header\">Amount</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-items-section\"></div>\n\t\t\t\t\t<div class=\"cart-totals-section\"></div>\n\t\t\t\t\t<div class=\"numpad-section\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\t\tthis.$cart_container = this.$component.find('.cart-container');\n\n\t\tthis.make_cart_totals_section();\n\t\tthis.make_cart_items_section();\n\t\tthis.make_cart_numpad();\n\t}\n\n\tmake_cart_items_section() {\n\t\tthis.$cart_header = this.$component.find('.cart-header');\n\t\tthis.$cart_items_wrapper = this.$component.find('.cart-items-section');\n\n\t\tthis.make_no_items_placeholder();\n\t}\n\n\tmake_no_items_placeholder() {\n\t\tthis.$cart_header.css('display', 'none');\n\t\tthis.$cart_items_wrapper.html(\n\t\t\t`<div class=\"no-item-wrapper\">No items in cart</div>`\n\t\t);\n\t}\n\n\tget_discount_icon() {\n\t\treturn (\n\t\t\t`<svg class=\"discount-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<path d=\"M19 15.6213C19 15.2235 19.158 14.842 19.4393 14.5607L20.9393 13.0607C21.5251 12.4749 21.5251 11.5251 20.9393 10.9393L19.4393 9.43934C19.158 9.15804 19 8.7765 19 8.37868V6.5C19 5.67157 18.3284 5 17.5 5H15.6213C15.2235 5 14.842 4.84196 14.5607 4.56066L13.0607 3.06066C12.4749 2.47487 11.5251 2.47487 10.9393 3.06066L9.43934 4.56066C9.15804 4.84196 8.7765 5 8.37868 5H6.5C5.67157 5 5 5.67157 5 6.5V8.37868C5 8.7765 4.84196 9.15804 4.56066 9.43934L3.06066 10.9393C2.47487 11.5251 2.47487 12.4749 3.06066 13.0607L4.56066 14.5607C4.84196 14.842 5 15.2235 5 15.6213V17.5C5 18.3284 5.67157 19 6.5 19H8.37868C8.7765 19 9.15804 19.158 9.43934 19.4393L10.9393 20.9393C11.5251 21.5251 12.4749 21.5251 13.0607 20.9393L14.5607 19.4393C14.842 19.158 15.2235 19 15.6213 19H17.5C18.3284 19 19 18.3284 19 17.5V15.6213Z\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15 9L9 15\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M10.5 9.5C10.5 10.0523 10.0523 10.5 9.5 10.5C8.94772 10.5 8.5 10.0523 8.5 9.5C8.5 8.94772 8.94772 8.5 9.5 8.5C10.0523 8.5 10.5 8.94772 10.5 9.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15.5 14.5C15.5 15.0523 15.0523 15.5 14.5 15.5C13.9477 15.5 13.5 15.0523 13.5 14.5C13.5 13.9477 13.9477 13.5 14.5 13.5C15.0523 13.5 15.5 13.9477 15.5 14.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t</svg>`\n\t\t);\n\t}\n\n\tmake_cart_totals_section() {\n\t\tthis.$totals_section = this.$component.find('.cart-totals-section');\n\n\t\tthis.$totals_section.append(\n\t\t\t`<div class=\"add-discount-wrapper\">\n\t\t\t\t${this.get_discount_icon()} Add Discount\n\t\t\t</div>\n\t\t\t<div class=\"net-total-container\">\n\t\t\t\t<div class=\"net-total-label\">Net Total</div>\n\t\t\t\t<div class=\"net-total-value\">0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"taxes-container\"></div>\n\t\t\t<div class=\"grand-total-container\">\n\t\t\t\t<div>Grand Total</div>\n\t\t\t\t<div>0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"checkout-btn\">Checkout</div>\n\t\t\t<div class=\"edit-cart-btn\">Edit Cart</div>`\n\t\t)\n\n\t\tthis.$add_discount_elem = this.$component.find(\".add-discount-wrapper\");\n\t}\n\n\tmake_cart_numpad() {\n\t\tthis.$numpad_section = this.$component.find('.numpad-section');\n\n\t\tthis.number_pad = new erpnext.PointOfSale.NumberPad({\n\t\t\twrapper: this.$numpad_section,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: this.on_numpad_event.bind(this)\n\t\t\t},\n\t\t\tcols: 5,\n\t\t\tkeys: [\n\t\t\t\t[ 1, 2, 3, 'Quantity' ],\n\t\t\t\t[ 4, 5, 6, 'Discount' ],\n\t\t\t\t[ 7, 8, 9, 'Rate' ],\n\t\t\t\t[ '.', 0, 'Delete', 'Remove' ]\n\t\t\t],\n\t\t\tcss_classes: [\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2 remove-btn' ]\n\t\t\t],\n\t\t\tfieldnames_map: { 'Quantity': 'qty', 'Discount': 'discount_percentage' }\n\t\t})\n\n\t\tthis.$numpad_section.prepend(\n\t\t\t`<div class=\"numpad-totals\">\n\t\t\t\t<span class=\"numpad-net-total\"></span>\n\t\t\t\t<span class=\"numpad-grand-total\"></span>\n\t\t\t</div>`\n\t\t)\n\n\t\tthis.$numpad_section.append(\n\t\t\t`<div class=\"numpad-btn checkout-btn\" data-button-value=\"checkout\">Checkout</div>`\n\t\t)\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.$customer_section.on('click', '.reset-customer-btn', function () {\n\t\t\tme.reset_customer_selector();\n\t\t});\n\n\t\tthis.$customer_section.on('click', '.close-details-btn', function () {\n\t\t\tme.toggle_customer_info(false);\n\t\t});\n\n\t\tthis.$customer_section.on('click', '.customer-display', function(e) {\n\t\t\tif ($(e.target).closest('.reset-customer-btn').length) return;\n\n\t\t\tconst show = me.$cart_container.is(':visible');\n\t\t\tme.toggle_customer_info(show);\n\t\t});\n\n\t\tthis.$cart_items_wrapper.on('click', '.cart-item-wrapper', function() {\n\t\t\tconst $cart_item = $(this);\n\n\t\t\tme.toggle_item_highlight(this);\n\n\t\t\tconst payment_section_hidden = !me.$totals_section.find('.edit-cart-btn').is(':visible');\n\t\t\tif (!payment_section_hidden) {\n\t\t\t\t// payment section is visible\n\t\t\t\t// edit cart first and then open item details section\n\t\t\t\tme.$totals_section.find(\".edit-cart-btn\").click();\n\t\t\t}\n\n\t\t\tconst item_row_name = unescape($cart_item.attr('data-row-name'));\n\t\t\tme.events.cart_item_clicked({ name: item_row_name });\n\t\t\tthis.numpad_value = '';\n\t\t});\n\n\t\tthis.$component.on('click', '.checkout-btn', function() {\n\t\t\tif ($(this).attr('style').indexOf('--blue-500') == -1) return;\n\n\t\t\tme.events.checkout();\n\t\t\tme.toggle_checkout_btn(false);\n\n\t\t\tme.allow_discount_change && me.$add_discount_elem.removeClass(\"d-none\");\n\t\t});\n\n\t\tthis.$totals_section.on('click', '.edit-cart-btn', () => {\n\t\t\tthis.events.edit_cart();\n\t\t\tthis.toggle_checkout_btn(true);\n\t\t});\n\n\t\tthis.$component.on('click', '.add-discount-wrapper', () => {\n\t\t\tconst can_edit_discount = this.$add_discount_elem.find('.edit-discount-btn').length;\n\n\t\t\tif(!this.discount_field || can_edit_discount) this.show_discount_control();\n\t\t});\n\n\t\tfrappe.ui.form.on(\"POS Invoice\", \"paid_amount\", frm => {\n\t\t\t// called when discount is applied\n\t\t\tthis.update_totals_section(frm);\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tfor (let row of this.number_pad.keys) {\n\t\t\tfor (let btn of row) {\n\t\t\t\tif (typeof btn !== 'string') continue; // do not make shortcuts for numbers\n\n\t\t\t\tlet shortcut_key = `ctrl+${frappe.scrub(String(btn))[0]}`;\n\t\t\t\tif (btn === 'Delete') shortcut_key = 'ctrl+backspace';\n\t\t\t\tif (btn === 'Remove') shortcut_key = 'shift+ctrl+backspace'\n\t\t\t\tif (btn === '.') shortcut_key = 'ctrl+>';\n\n\t\t\t\t// to account for fieldname map\n\t\t\t\tconst fieldname = this.number_pad.fieldnames[btn] ? this.number_pad.fieldnames[btn] :\n\t\t\t\t\ttypeof btn === 'string' ? frappe.scrub(btn) : btn;\n\n\t\t\t\tlet shortcut_label = shortcut_key.split('+').map(frappe.utils.to_title_case).join('+');\n\t\t\t\tshortcut_label = frappe.utils.is_mac() ? shortcut_label.replace('Ctrl', '⌘') : shortcut_label;\n\t\t\t\tthis.$numpad_section.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`).attr(\"title\", shortcut_label);\n\n\t\t\t\tfrappe.ui.keys.on(`${shortcut_key}`, () => {\n\t\t\t\t\tconst cart_is_visible = this.$component.is(\":visible\");\n\t\t\t\t\tif (cart_is_visible && this.item_is_selected && this.$numpad_section.is(\":visible\")) {\n\t\t\t\t\t\tthis.$numpad_section.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`).click();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '⌘' : 'Ctrl';\n\t\tthis.$component.find(\".checkout-btn\").attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+enter\",\n\t\t\taction: () => this.$component.find(\".checkout-btn\").click(),\n\t\t\tcondition: () => this.$component.is(\":visible\") && !this.$totals_section.find('.edit-cart-btn').is(':visible'),\n\t\t\tdescription: __(\"Checkout Order / Submit Order / New Order\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.$component.find(\".edit-cart-btn\").attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.on(\"ctrl+e\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tconst checkout_btn_invisible = !this.$totals_section.find('.checkout-btn').is('visible');\n\t\t\tif (item_cart_visible && checkout_btn_invisible) {\n\t\t\t\tthis.$component.find(\".edit-cart-btn\").click();\n\t\t\t}\n\t\t});\n\t\tthis.$component.find(\".add-discount-wrapper\").attr(\"title\", `${ctrl_label}+D`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+d\",\n\t\t\taction: () => this.$component.find(\".add-discount-wrapper\").click(),\n\t\t\tcondition: () => this.$add_discount_elem.is(\":visible\"),\n\t\t\tdescription: __(\"Add Order Discount\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tif (item_cart_visible && this.discount_field && this.discount_field.parent.is(\":visible\")) {\n\t\t\t\tthis.discount_field.set_value(0);\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggle_item_highlight(item) {\n\t\tconst $cart_item = $(item);\n\t\tconst item_is_highlighted = $cart_item.attr(\"style\") == \"background-color:var(--gray-50);\";\n\n\t\tif (!item || item_is_highlighted) {\n\t\t\tthis.item_is_selected = false;\n\t\t\tthis.$cart_container.find('.cart-item-wrapper').css(\"background-color\", \"\");\n\t\t} else {\n\t\t\t$cart_item.css(\"background-color\", \"var(--gray-50)\");\n\t\t\tthis.item_is_selected = true;\n\t\t\tthis.$cart_container.find('.cart-item-wrapper').not(item).css(\"background-color\", \"\");\n\t\t}\n\t}\n\n\tmake_customer_selector() {\n\t\tthis.$customer_section.html(`\n\t\t\t<div class=\"customer-field\"></div>\n\t\t`);\n\t\tconst me = this;\n\t\tconst query = { query: 'erpnext.controllers.queries.customer_query' };\n\t\tconst allowed_customer_group = this.allowed_customer_groups || [];\n\t\tif (allowed_customer_group.length) {\n\t\t\tquery.filters = {\n\t\t\t\tcustomer_group: ['in', allowed_customer_group]\n\t\t\t}\n\t\t}\n\t\tthis.customer_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Customer'),\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\toptions: 'Customer',\n\t\t\t\tplaceholder: __('Search by customer name, phone, email.'),\n\t\t\t\tget_query: () => query,\n\t\t\t\tonchange: function() {\n\t\t\t\t\tif (this.value) {\n\t\t\t\t\t\tconst frm = me.events.get_frm();\n\t\t\t\t\t\tfrappe.dom.freeze();\n\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'customer', this.value);\n\t\t\t\t\t\tfrm.script_manager.trigger('customer', frm.doc.doctype, frm.doc.name).then(() => {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => me.fetch_customer_details(this.value),\n\t\t\t\t\t\t\t\t() => me.events.customer_details_updated(me.customer_info),\n\t\t\t\t\t\t\t\t() => me.update_customer_section(),\n\t\t\t\t\t\t\t\t() => me.update_totals_section(),\n\t\t\t\t\t\t\t\t() => frappe.dom.unfreeze()\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$customer_section.find('.customer-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.customer_field.toggle_label(false);\n\t}\n\n\tfetch_customer_details(customer) {\n\t\tif (customer) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tfrappe.db.get_value('Customer', customer, [\"email_id\", \"mobile_no\", \"image\", \"loyalty_program\"]).then(({ message }) => {\n\t\t\t\t\tconst { loyalty_program } = message;\n\t\t\t\t\t// if loyalty program then fetch loyalty points too\n\t\t\t\t\tif (loyalty_program) {\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"erpnext.accounts.doctype.loyalty_program.loyalty_program.get_loyalty_program_details_with_points\",\n\t\t\t\t\t\t\targs: { customer, loyalty_program, \"silent\": true },\n\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\tconst { loyalty_points, conversion_factor } = r.message;\n\t\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\t\tthis.customer_info = { ...message, customer, loyalty_points, conversion_factor };\n\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.customer_info = { ...message, customer };\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tthis.customer_info = {}\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t}\n\n\tshow_discount_control() {\n\t\tthis.$add_discount_elem.css({ 'padding': '0px', 'border': 'none' });\n\t\tthis.$add_discount_elem.html(\n\t\t\t`<div class=\"add-discount-field\"></div>`\n\t\t);\n\t\tconst me = this;\n\t\tconst frm = me.events.get_frm();\n\t\tlet discount = frm.doc.additional_discount_percentage;\n\n\t\tthis.discount_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Discount'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: ( discount ? discount + '%' :  __('Enter discount percentage.') ),\n\t\t\t\tinput_class: 'input-xs',\n\t\t\t\tonchange: function() {\n\t\t\t\t\tif (flt(this.value) != 0) {\n\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'additional_discount_percentage', flt(this.value));\n\t\t\t\t\t\tme.hide_discount_control(this.value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'additional_discount_percentage', 0);\n\t\t\t\t\t\tme.$add_discount_elem.css({\n\t\t\t\t\t\t\t'border': '1px dashed var(--gray-500)',\n\t\t\t\t\t\t\t'padding': 'var(--padding-sm) var(--padding-md)'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme.$add_discount_elem.html(`${me.get_discount_icon()} Add Discount`);\n\t\t\t\t\t\tme.discount_field = undefined;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$add_discount_elem.find('.add-discount-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.discount_field.toggle_label(false);\n\t\tthis.discount_field.set_focus();\n\t}\n\n\thide_discount_control(discount) {\n\t\tif (!discount) {\n\t\t\tthis.$add_discount_elem.css({ 'padding': '0px', 'border': 'none' });\n\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t`<div class=\"add-discount-field\"></div>`\n\t\t\t);\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css({\n\t\t\t\t'border': '1px dashed var(--dark-green-500)',\n\t\t\t\t'padding': 'var(--padding-sm) var(--padding-md)'\n\t\t\t});\n\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t`<div class=\"edit-discount-btn\">\n\t\t\t\t\t${this.get_discount_icon()} Additional&nbsp;${String(discount).bold()}% discount applied\n\t\t\t\t</div>`\n\t\t\t);\n\t\t}\n\t}\n\n\tupdate_customer_section() {\n\t\tconst me = this;\n\t\tconst { customer, email_id='', mobile_no='', image } = this.customer_info || {};\n\n\t\tif (customer) {\n\t\t\tthis.$customer_section.html(\n\t\t\t\t`<div class=\"customer-details\">\n\t\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t\t${get_customer_description()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"reset-customer-btn\" data-customer=\"${escape(customer)}\">\n\t\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t\t} else {\n\t\t\t// reset customer selector\n\t\t\tthis.reset_customer_selector();\n\t\t}\n\n\t\tfunction get_customer_description() {\n\t\t\tif (!email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">Click to add email / phone</div>`;\n\t\t\t} else if (email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id}</div>`;\n\t\t\t} else if (mobile_no && !email_id) {\n\t\t\t\treturn `<div class=\"customer-desc\">${mobile_no}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id} - ${mobile_no}</div>`;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tget_customer_image() {\n\t\tconst { customer, image } = this.customer_info || {};\n\t\tif (image) {\n\t\t\treturn `<div class=\"customer-image\"><img src=\"${image}\" alt=\"${image}\"\"></div>`;\n\t\t} else {\n\t\t\treturn `<div class=\"customer-image customer-abbr\">${frappe.get_abbr(customer)}</div>`;\n\t\t}\n\t}\n\n\tupdate_totals_section(frm) {\n\t\tif (!frm) frm = this.events.get_frm();\n\n\t\tthis.render_net_total(frm.doc.net_total);\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? frm.doc.grand_total : frm.doc.rounded_total;\n\t\tthis.render_grand_total(grand_total);\n\n\t\tthis.render_taxes(frm.doc.taxes);\n\t}\n\n\trender_net_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section.find('.net-total-container').html(\n\t\t\t`<div>Net Total</div><div>${format_currency(value, currency)}</div>`\n\t\t)\n\n\t\tthis.$numpad_section.find('.numpad-net-total').html(\n\t\t\t`<div>Net Total: <span>${format_currency(value, currency)}</span></div>`\n\t\t);\n\t}\n\n\trender_grand_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section.find('.grand-total-container').html(\n\t\t\t`<div>Grand Total</div><div>${format_currency(value, currency)}</div>`\n\t\t)\n\n\t\tthis.$numpad_section.find('.numpad-grand-total').html(\n\t\t\t`<div>Grand Total: <span>${format_currency(value, currency)}</span></div>`\n\t\t);\n\t}\n\n\trender_taxes(taxes) {\n\t\tif (taxes.length) {\n\t\t\tconst currency = this.events.get_frm().doc.currency;\n\t\t\tconst taxes_html = taxes.map(t => {\n\t\t\t\tconst description = /[0-9]+/.test(t.description) ? t.description : `${t.description} @ ${t.rate}%`;\n\t\t\t\treturn `<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, currency)}</div>\n\t\t\t\t</div>`;\n\t\t\t}).join('');\n\t\t\tthis.$totals_section.find('.taxes-container').css('display', 'flex').html(taxes_html);\n\t\t} else {\n\t\t\tthis.$totals_section.find('.taxes-container').css('display', 'none').html('');\n\t\t}\n\t}\n\n\tget_cart_item({ name }) {\n\t\tconst item_selector = `.cart-item-wrapper[data-row-name=\"${escape(name)}\"]`;\n\t\treturn this.$cart_items_wrapper.find(item_selector);\n\t}\n\n\tget_item_from_frm(item) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\treturn doc.items.find(i => i.name == item.name);\n\t}\n\n\tupdate_item_html(item, remove_item) {\n\t\tconst $item = this.get_cart_item(item);\n\n\t\tif (remove_item) {\n\t\t\t$item && $item.next().remove() && $item.remove();\n\t\t} else {\n\t\t\tconst item_row = this.get_item_from_frm(item);\n\t\t\tthis.render_cart_item(item_row, $item);\n\t\t}\n\n\t\tconst no_of_cart_items = this.$cart_items_wrapper.find('.cart-item-wrapper').length;\n\t\tthis.highlight_checkout_btn(no_of_cart_items > 0);\n\n\t\tthis.update_empty_cart_section(no_of_cart_items);\n\t}\n\n\trender_cart_item(item_data, $item_to_update) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tconst me = this;\n\n\t\tif (!$item_to_update.length) {\n\t\t\tthis.$cart_items_wrapper.append(\n\t\t\t\t`<div class=\"cart-item-wrapper\" data-row-name=\"${escape(item_data.name)}\"></div>\n\t\t\t\t<div class=\"seperator\"></div>`\n\t\t\t)\n\t\t\t$item_to_update = this.get_cart_item(item_data);\n\t\t}\n\n\t\t$item_to_update.html(\n\t\t\t`${get_item_image_html()}\n\t\t\t<div class=\"item-name-desc\">\n\t\t\t\t<div class=\"item-name\">\n\t\t\t\t\t${item_data.item_name}\n\t\t\t\t</div>\n\t\t\t\t${get_description_html()}\n\t\t\t</div>\n\t\t\t${get_rate_discount_html()}`\n\t\t)\n\n\t\tset_dynamic_rate_header_width();\n\n\t\tfunction set_dynamic_rate_header_width() {\n\t\t\tconst rate_cols = Array.from(me.$cart_items_wrapper.find(\".item-rate-amount\"));\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", \"\");\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", \"\");\n\t\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\t\tif ($(elm).width() > max_width)\n\t\t\t\t\tmax_width = $(elm).width();\n\t\t\t\treturn max_width;\n\t\t\t}, 0);\n\n\t\t\tmax_width += 1;\n\t\t\tif (max_width == 1) max_width = \"\";\n\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", max_width);\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", max_width);\n\t\t}\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (item_data.rate && item_data.amount && item_data.rate !== item_data.amount) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.amount, currency)}</div>\n\t\t\t\t\t\t\t<div class=\"item-amount\">${format_currency(item_data.rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`\n\t\t\t} else {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`\n\t\t\t}\n\t\t}\n\n\t\tfunction get_description_html() {\n\t\t\tif (item_data.description) {\n\t\t\t\tif (item_data.description.indexOf('<div>') != -1) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\titem_data.description = $(item_data.description).text();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\titem_data.description = item_data.description.replace(/<div>/g, ' ').replace(/<\\/div>/g, ' ').replace(/ +/g, ' ');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\titem_data.description = frappe.ellipsis(item_data.description, 45);\n\t\t\t\treturn `<div class=\"item-desc\">${item_data.description}</div>`;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tconst { image, item_name } = item_data;\n\t\t\tif (!me.hide_images && image) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-image\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tonerror=\"cur_pos.cart.handle_broken_image(this)\"\n\t\t\t\t\t\t\tsrc=\"${image}\" alt=\"${frappe.get_abbr(item_name)}\"\">\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-image item-abbr\">${frappe.get_abbr(item_name)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).parent().replaceWith(`<div class=\"item-image item-abbr\">${item_abbr}</div>`);\n\t}\n\n\tupdate_selector_value_in_cart_item(selector, value, item) {\n\t\tconst $item_to_update = this.get_cart_item(item);\n\t\t$item_to_update.attr(`data-${selector}`, escape(value));\n\t}\n\n\ttoggle_checkout_btn(show_checkout) {\n\t\tif (show_checkout) {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'flex');\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t} else {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'none');\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'flex');\n\t\t}\n\t}\n\n\thighlight_checkout_btn(toggle) {\n\t\tif (toggle) {\n\t\t\tthis.$add_discount_elem.css('display', 'flex');\n\t\t\tthis.$cart_container.find('.checkout-btn').css({\n\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t});\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css('display', 'none');\n\t\t\tthis.$cart_container.find('.checkout-btn').css({\n\t\t\t\t'background-color': 'var(--blue-200)'\n\t\t\t});\n\t\t}\n\t}\n\n\tupdate_empty_cart_section(no_of_cart_items) {\n\t\tconst $no_item_element = this.$cart_items_wrapper.find('.no-item-wrapper');\n\n\t\t// if cart has items and no item is present\n\t\tno_of_cart_items > 0 && $no_item_element && $no_item_element.remove() && this.$cart_header.css('display', 'flex');\n\n\t\tno_of_cart_items === 0 && !$no_item_element.length && this.make_no_items_placeholder();\n\t}\n\n\ton_numpad_event($btn) {\n\t\tconst current_action = $btn.attr('data-button-value');\n\t\tconst action_is_field_edit = ['qty', 'discount_percentage', 'rate'].includes(current_action);\n\t\tconst action_is_allowed = action_is_field_edit ? (\n\t\t\t(current_action == 'rate' && this.allow_rate_change) ||\n\t\t\t(current_action == 'discount_percentage' && this.allow_discount_change) ||\n\t\t\t(current_action == 'qty')) : true;\n\n\t\tconst action_is_pressed_twice = this.prev_action === current_action;\n\t\tconst first_click_event = !this.prev_action;\n\t\tconst field_to_edit_changed = this.prev_action && this.prev_action != current_action;\n\n\t\tif (action_is_field_edit) {\n\t\t\tif (!action_is_allowed) {\n\t\t\t\tconst label = current_action == 'rate' ? 'Rate'.bold() : 'Discount'.bold();\n\t\t\t\tconst message = __('Editing {0} is not allowed as per POS Profile settings', [label]);\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: message\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (first_click_event || field_to_edit_changed) {\n\t\t\t\tthis.prev_action = current_action;\n\t\t\t} else if (action_is_pressed_twice) {\n\t\t\t\tthis.prev_action = undefined;\n\t\t\t}\n\t\t\tthis.numpad_value = '';\n\n\t\t} else if (current_action === 'checkout') {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else if (current_action === 'remove') {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.numpad_value = current_action === 'delete' ? this.numpad_value.slice(0, -1) : this.numpad_value + current_action;\n\t\t\tthis.numpad_value = this.numpad_value || 0;\n\t\t}\n\n\t\tconst first_click_event_is_not_field_edit = !action_is_field_edit && first_click_event;\n\n\t\tif (first_click_event_is_not_field_edit) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tindicator: 'red',\n\t\t\t\tmessage: __('Please select a field to edit from numpad')\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (flt(this.numpad_value) > 100 && this.prev_action === 'discount_percentage') {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __('Discount cannot be greater than 100%'),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\tthis.numpad_value = current_action;\n\t\t}\n\n\t\tthis.highlight_numpad_btn($btn, current_action);\n\t\tthis.events.numpad_event(this.numpad_value, this.prev_action);\n\t}\n\n\thighlight_numpad_btn($btn, curr_action) {\n\t\tconst curr_action_is_highlighted = $btn.hasClass('highlighted-numpad-btn');\n\t\tconst curr_action_is_action = ['qty', 'discount_percentage', 'rate', 'done'].includes(curr_action);\n\n\t\tif (!curr_action_is_highlighted) {\n\t\t\t$btn.addClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (this.prev_action === curr_action && curr_action_is_highlighted) {\n\t\t\t// if Qty is pressed twice\n\t\t\t$btn.removeClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (this.prev_action && this.prev_action !== curr_action && curr_action_is_action) {\n\t\t\t// Order: Qty -> Rate then remove Qty highlight\n\t\t\tconst prev_btn = $(`[data-button-value='${this.prev_action}']`);\n\t\t\tprev_btn.removeClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (!curr_action_is_action || curr_action === 'done') {\n\t\t\t// if numbers are clicked\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass('highlighted-numpad-btn');\n\t\t\t}, 200);\n\t\t}\n\t}\n\n\ttoggle_numpad(show) {\n\t\tif (show) {\n\t\t\tthis.$totals_section.css('display', 'none');\n\t\t\tthis.$numpad_section.css('display', 'flex');\n\t\t} else {\n\t\t\tthis.$totals_section.css('display', 'flex');\n\t\t\tthis.$numpad_section.css('display', 'none');\n\t\t}\n\t\tthis.reset_numpad();\n\t}\n\n\treset_numpad() {\n\t\tthis.numpad_value = '';\n\t\tthis.prev_action = undefined;\n\t\tthis.$numpad_section.find('.highlighted-numpad-btn').removeClass('highlighted-numpad-btn');\n\t}\n\n\ttoggle_numpad_field_edit(fieldname) {\n\t\tif (['qty', 'discount_percentage', 'rate'].includes(fieldname)) {\n\t\t\tthis.$numpad_section.find(`[data-button-value=\"${fieldname}\"]`).click();\n\t\t}\n\t}\n\n\ttoggle_customer_info(show) {\n\t\tif (show) {\n\t\t\tconst { customer } = this.customer_info || {};\n\n\t\t\tthis.$cart_container.css('display', 'none');\n\t\t\tthis.$customer_section.css({\n\t\t\t\t'height': '100%',\n\t\t\t\t'padding-top': '0px'\n\t\t\t});\n\t\t\tthis.$customer_section.find('.customer-details').html(\n\t\t\t\t`<div class=\"header\">\n\t\t\t\t\t<div class=\"label\">Contact Details</div>\n\t\t\t\t\t<div class=\"close-details-btn\">\n\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t<div class=\"customer-desc\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-fields-container\">\n\t\t\t\t\t<div class=\"email_id-field\"></div>\n\t\t\t\t\t<div class=\"mobile_no-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_program-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_points-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"transactions-label\">Recent Transactions</div>`\n\t\t\t);\n\t\t\t// transactions need to be in diff div from sticky elem for scrolling\n\t\t\tthis.$customer_section.append(`<div class=\"customer-transactions\"></div>`);\n\n\t\t\tthis.render_customer_fields();\n\t\t\tthis.fetch_customer_transactions();\n\n\t\t} else {\n\t\t\tthis.$cart_container.css('display', 'flex');\n\t\t\tthis.$customer_section.css({\n\t\t\t\t'height': '',\n\t\t\t\t'padding-top': ''\n\t\t\t});\n\n\t\t\tthis.update_customer_section();\n\t\t}\n\t}\n\n\trender_customer_fields() {\n\t\tconst $customer_form = this.$customer_section.find('.customer-fields-container');\n\n\t\tconst dfs = [{\n\t\t\tfieldname: 'email_id',\n\t\t\tlabel: __('Email'),\n\t\t\tfieldtype: 'Data',\n\t\t\toptions: 'email',\n\t\t\tplaceholder: __(\"Enter customer's email\")\n\t\t},{\n\t\t\tfieldname: 'mobile_no',\n\t\t\tlabel: __('Phone Number'),\n\t\t\tfieldtype: 'Data',\n\t\t\tplaceholder: __(\"Enter customer's phone number\")\n\t\t},{\n\t\t\tfieldname: 'loyalty_program',\n\t\t\tlabel: __('Loyalty Program'),\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: 'Loyalty Program',\n\t\t\tplaceholder: __(\"Select Loyalty Program\")\n\t\t},{\n\t\t\tfieldname: 'loyalty_points',\n\t\t\tlabel: __('Loyalty Points'),\n\t\t\tfieldtype: 'Data',\n\t\t\tread_only: 1\n\t\t}];\n\n\t\tconst me = this;\n\t\tdfs.forEach(df => {\n\t\t\tthis[`customer_${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\tdf: { ...df,\n\t\t\t\t\tonchange: handle_customer_field_change,\n\t\t\t\t},\n\t\t\t\tparent: $customer_form.find(`.${df.fieldname}-field`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`customer_${df.fieldname}_field`].set_value(this.customer_info[df.fieldname]);\n\t\t})\n\n\t\tfunction handle_customer_field_change() {\n\t\t\tconst current_value = me.customer_info[this.df.fieldname];\n\t\t\tconst current_customer = me.customer_info.customer;\n\n\t\t\tif (this.value && current_value != this.value && this.df.fieldname != 'loyalty_points') {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'erpnext.selling.page.point_of_sale.point_of_sale.set_customer_info',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tfieldname: this.df.fieldname,\n\t\t\t\t\t\tcustomer: current_customer,\n\t\t\t\t\t\tvalue: this.value\n\t\t\t\t\t},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tme.customer_info[this.df.fieldname] = this.value;\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Customer contact updated successfully.\"),\n\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tfetch_customer_transactions() {\n\t\tfrappe.db.get_list('POS Invoice', {\n\t\t\tfilters: { customer: this.customer_info.customer, docstatus: 1 },\n\t\t\tfields: ['name', 'grand_total', 'status', 'posting_date', 'posting_time', 'currency'],\n\t\t\tlimit: 20\n\t\t}).then((res) => {\n\t\t\tconst transaction_container = this.$customer_section.find('.customer-transactions');\n\n\t\t\tif (!res.length) {\n\t\t\t\ttransaction_container.html(\n\t\t\t\t\t`<div class=\"no-transactions-placeholder\">No recent transactions found</div>`\n\t\t\t\t)\n\t\t\t\treturn;\n\t\t\t};\n\n\t\t\tconst elapsed_time = moment(res[0].posting_date+\" \"+res[0].posting_time).fromNow();\n\t\t\tthis.$customer_section.find('.customer-desc').html(`Last transacted ${elapsed_time}`);\n\n\t\t\tres.forEach(invoice => {\n\t\t\t\tconst posting_datetime = moment(invoice.posting_date+\" \"+invoice.posting_time).format(\"Do MMMM, h:mma\");\n\t\t\t\tlet indicator_color = {\n\t\t\t\t\t'Paid': 'green',\n\t\t\t\t\t'Draft': 'red',\n\t\t\t\t\t'Return': 'gray',\n\t\t\t\t\t'Consolidated': 'blue'\n\t\t\t\t};\n\n\t\t\t\ttransaction_container.append(\n\t\t\t\t\t`<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t\t\t<div class=\"invoice-total\">\n\t\t\t\t\t\t\t\t${format_currency(invoice.grand_total, invoice.currency, 0) || 0}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"invoice-status\">\n\t\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color[invoice.status]}\">\n\t\t\t\t\t\t\t\t\t<span>${invoice.status}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"seperator\"></div>`\n\t\t\t\t)\n\t\t\t});\n\t\t});\n\t}\n\n\tattach_refresh_field_event(frm) {\n\t\t$(frm.wrapper).off('refresh-fields');\n\t\t$(frm.wrapper).on('refresh-fields', () => {\n\t\t\tif (frm.doc.items.length) {\n\t\t\t\tfrm.doc.items.forEach(item => {\n\t\t\t\t\tthis.update_item_html(item);\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.update_totals_section(frm);\n\t\t});\n\t}\n\n\tload_invoice() {\n\t\tconst frm = this.events.get_frm();\n\n\t\tthis.attach_refresh_field_event(frm);\n\n\t\tthis.fetch_customer_details(frm.doc.customer).then(() => {\n\t\t\tthis.events.customer_details_updated(this.customer_info);\n\t\t\tthis.update_customer_section();\n\t\t});\n\n\t\tthis.$cart_items_wrapper.html('');\n\t\tif (frm.doc.items.length) {\n\t\t\tfrm.doc.items.forEach(item => {\n\t\t\t\tthis.update_item_html(item);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.make_no_items_placeholder();\n\t\t\tthis.highlight_checkout_btn(false);\n\t\t}\n\n\t\tthis.update_totals_section(frm);\n\n\t\tif(frm.doc.docstatus === 1) {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'none');\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t} else {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'flex');\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t}\n\n\t\tthis.toggle_component(true);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n\n}\n","erpnext.PointOfSale.ItemDetails = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.current_item = {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"item-details-container\"></section>`\n\t\t)\n\n\t\tthis.$component = this.wrapper.find('.item-details-container');\n\t}\n\n\tinit_child_components() {\n\t\tthis.$component.html(\n\t\t\t`<div class=\"item-details-header\">\n\t\t\t\t<div class=\"label\">Item Details</div>\n\t\t\t\t<div class=\"close-btn\">\n\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"item-display\">\n\t\t\t\t<div class=\"item-name-desc-price\">\n\t\t\t\t\t<div class=\"item-name\"></div>\n\t\t\t\t\t<div class=\"item-desc\"></div>\n\t\t\t\t\t<div class=\"item-price\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"item-image\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"discount-section\"></div>\n\t\t\t<div class=\"form-container\"></div>`\n\t\t)\n\n\t\tthis.$item_name = this.$component.find('.item-name');\n\t\tthis.$item_description = this.$component.find('.item-desc');\n\t\tthis.$item_price = this.$component.find('.item-price');\n\t\tthis.$item_image = this.$component.find('.item-image');\n\t\tthis.$form_container = this.$component.find('.form-container');\n\t\tthis.$dicount_section = this.$component.find('.discount-section');\n\t}\n\n\tcompare_with_current_item(item) {\n\t\t// returns true if `item` is currently being edited\n\t\treturn item && item.name == this.current_item.name;\n\t}\n\n\ttoggle_item_details_section(item) {\n\t\tconst current_item_changed = !this.compare_with_current_item(item);\n\n\t\t// if item is null or highlighted cart item is clicked twice\n\t\tconst hide_item_details = !Boolean(item) || !current_item_changed;\n\n\t\tthis.events.toggle_item_selector(!hide_item_details);\n\t\tthis.toggle_component(!hide_item_details);\n\n\t\tif (item && current_item_changed) {\n\t\t\tthis.doctype = item.doctype;\n\t\t\tthis.item_meta = frappe.get_meta(this.doctype);\n\t\t\tthis.name = item.name;\n\t\t\tthis.item_row = item;\n\t\t\tthis.currency = this.events.get_frm().doc.currency;\n\n\t\t\tthis.current_item = item;\n\n\t\t\tthis.render_dom(item);\n\t\t\tthis.render_discount_dom(item);\n\t\t\tthis.render_form(item);\n\t\t\tthis.events.highlight_cart_item(item);\n\t\t} else {\n\t\t\tthis.validate_serial_batch_item();\n\t\t\tthis.current_item = {};\n\t\t}\n\t}\n\n\tvalidate_serial_batch_item() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst item_row = doc.items.find(item => item.name === this.name);\n\n\t\tif (!item_row) return;\n\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_serial_selected = !item_row.serial_no;\n\t\tconst no_batch_selected = !item_row.batch_no;\n\n\t\tif ((serialized && no_serial_selected) || (batched && no_batch_selected) ||\n\t\t\t(serialized && batched && (no_batch_selected || no_serial_selected))) {\n\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Item will be removed since no serial / batch no selected.\"),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\tthis.events.remove_item_from_cart();\n\t\t}\n\t}\n\n\trender_dom(item) {\n\t\tlet { item_name, description, image, price_list_rate } = item;\n\n\t\tfunction get_description_html() {\n\t\t\tif (description) {\n\t\t\t\tdescription = description.indexOf('...') === -1 && description.length > 140 ? description.substr(0, 139) + '...' : description;\n\t\t\t\treturn description;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tthis.$item_name.html(item_name);\n\t\tthis.$item_description.html(get_description_html());\n\t\tthis.$item_price.html(format_currency(price_list_rate, this.currency));\n\t\tif (!this.hide_images && image) {\n\t\t\tthis.$item_image.html(\n\t\t\t\t`<img\n\t\t\t\t\tonerror=\"cur_pos.item_details.handle_broken_image(this)\"\n\t\t\t\t\tclass=\"h-full\" src=\"${image}\"\n\t\t\t\t\talt=\"${frappe.get_abbr(item_name)}\"\n\t\t\t\t\tstyle=\"object-fit: cover;\">`\n\t\t\t);\n\t\t} else {\n\t\t\tthis.$item_image.html(`<div class=\"item-abbr\">${frappe.get_abbr(item_name)}</div>`);\n\t\t}\n\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).replaceWith(`<div class=\"item-abbr\">${item_abbr}</div>`);\n\t}\n\n\trender_discount_dom(item) {\n\t\tif (item.discount_percentage) {\n\t\t\tthis.$dicount_section.html(\n\t\t\t\t`<div class=\"item-rate\">${format_currency(item.price_list_rate, this.currency)}</div>\n\t\t\t\t<div class=\"item-discount\">${item.discount_percentage}% off</div>`\n\t\t\t)\n\t\t\tthis.$item_price.html(format_currency(item.rate, this.currency));\n\t\t} else {\n\t\t\tthis.$dicount_section.html(``)\n\t\t}\n\t}\n\n\trender_form(item) {\n\t\tconst fields_to_display = this.get_form_fields(item);\n\t\tthis.$form_container.html('');\n\n\t\tfields_to_display.forEach((fieldname, idx) => {\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"${fieldname}-control\" data-fieldname=\"${fieldname}\"></div>`\n\t\t\t)\n\n\t\t\tconst field_meta = this.item_meta.fields.find(df => df.fieldname === fieldname);\n\t\t\tfieldname === 'discount_percentage' ? (field_meta.label = __('Discount (%)')) : '';\n\t\t\tconst me = this;\n\n\t\t\tthis[`${fieldname}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\t...field_meta,\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tme.events.form_updated(me.current_item, fieldname, this.value);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tparent: this.$form_container.find(`.${fieldname}-control`),\n\t\t\t\trender_input: true,\n\t\t\t})\n\t\t\tthis[`${fieldname}_control`].set_value(item[fieldname]);\n\t\t});\n\n\t\tthis.make_auto_serial_selection_btn(item);\n\n\t\tthis.bind_custom_control_change_event();\n\t}\n\n\tget_form_fields(item) {\n\t\tconst fields = ['qty', 'uom', 'rate', 'conversion_factor', 'discount_percentage', 'warehouse', 'actual_qty', 'price_list_rate'];\n\t\tif (item.has_serial_no) fields.push('serial_no');\n\t\tif (item.has_batch_no) fields.push('batch_no');\n\t\treturn fields;\n\t}\n\n\tmake_auto_serial_selection_btn(item) {\n\t\tif (item.has_serial_no) {\n\t\t\tif (!item.has_batch_no) {\n\t\t\t\tthis.$form_container.append(\n\t\t\t\t\t`<div class=\"grid-filler no-select\"></div>`\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"btn btn-sm btn-secondary auto-fetch-btn\">Auto Fetch Serial Numbers</div>`\n\t\t\t);\n\t\t\tthis.$form_container.find('.serial_no-control').find('textarea').css('height', '6rem');\n\t\t}\n\t}\n\n\tbind_custom_control_change_event() {\n\t\tconst me = this;\n\t\tif (this.rate_control) {\n\t\t\tthis.rate_control.df.onchange = function() {\n\t\t\t\tif (this.value || flt(this.value) === 0) {\n\t\t\t\t\tme.events.form_updated(me.current_item, 'rate', this.value).then(() => {\n\t\t\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\t\t\tconst doc = me.events.get_frm().doc;\n\t\t\t\t\t\tme.$item_price.html(format_currency(item_row.rate, doc.currency));\n\t\t\t\t\t\tme.render_discount_dom(item_row);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.rate_control.df.read_only = !this.allow_rate_change;\n\t\t\tthis.rate_control.refresh();\n\t\t}\n\n\t\tif (this.discount_percentage_control && !this.allow_discount_change) {\n\t\t\tthis.discount_percentage_control.df.read_only = 1;\n\t\t\tthis.discount_percentage_control.refresh();\n\t\t}\n\n\t\tif (this.warehouse_control) {\n\t\t\tthis.warehouse_control.df.reqd = 1;\n\t\t\tthis.warehouse_control.df.onchange = function() {\n\t\t\t\tif (this.value) {\n\t\t\t\t\tme.events.form_updated(me.current_item, 'warehouse', this.value).then(() => {\n\t\t\t\t\t\tme.item_stock_map = me.events.get_item_stock_map();\n\t\t\t\t\t\tconst available_qty = me.item_stock_map[me.item_row.item_code][this.value];\n\t\t\t\t\t\tif (available_qty === undefined) {\n\t\t\t\t\t\t\tme.events.get_available_stock(me.item_row.item_code, this.value).then(() => {\n\t\t\t\t\t\t\t\t// item stock map is updated now reset warehouse\n\t\t\t\t\t\t\t\tme.warehouse_control.set_value(this.value);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else if (available_qty === 0) {\n\t\t\t\t\t\t\tme.warehouse_control.set_value('');\n\t\t\t\t\t\t\tconst bold_item_code = me.item_row.item_code.bold();\n\t\t\t\t\t\t\tconst bold_warehouse = this.value.bold();\n\t\t\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t\t\t__('Item Code: {0} is not available under warehouse {1}.', [bold_item_code, bold_warehouse])\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.actual_qty_control.set_value(available_qty);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.warehouse_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: { company: this.events.get_frm().doc.company }\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.warehouse_control.refresh();\n\t\t}\n\n\t\tif (this.serial_no_control) {\n\t\t\tthis.serial_no_control.df.reqd = 1;\n\t\t\tthis.serial_no_control.df.onchange = async function() {\n\t\t\t\t!me.current_item.batch_no && await me.auto_update_batch_no();\n\t\t\t\tme.events.form_updated(me.current_item, 'serial_no', this.value);\n\t\t\t}\n\t\t\tthis.serial_no_control.refresh();\n\t\t}\n\n\t\tif (this.batch_no_control) {\n\t\t\tthis.batch_no_control.df.reqd = 1;\n\t\t\tthis.batch_no_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tquery: 'erpnext.controllers.queries.get_batch_no',\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\titem_code: me.item_row.item_code,\n\t\t\t\t\t\twarehouse: me.item_row.warehouse,\n\t\t\t\t\t\tposting_date: me.events.get_frm().doc.posting_date\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.batch_no_control.refresh();\n\t\t}\n\n\t\tif (this.uom_control) {\n\t\t\tthis.uom_control.df.onchange = function() {\n\t\t\t\tme.events.form_updated(me.current_item, 'uom', this.value);\n\n\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\tme.conversion_factor_control.df.read_only = (item_row.stock_uom == this.value);\n\t\t\t\tme.conversion_factor_control.refresh();\n\t\t\t}\n\t\t}\n\n\t\tfrappe.model.on(\"POS Invoice Item\", \"*\", (fieldname, value, item_row) => {\n\t\t\tconst field_control = this[`${fieldname}_control`];\n\t\t\tconst item_row_is_being_edited = this.compare_with_current_item(item_row);\n\n\t\t\tif (item_row_is_being_edited && field_control && field_control.get_value() !== value) {\n\t\t\t\tfield_control.set_value(value);\n\t\t\t\tcur_pos.update_cart_html(item_row);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync auto_update_batch_no() {\n\t\tif (this.serial_no_control && this.batch_no_control) {\n\t\t\tconst selected_serial_nos = this.serial_no_control.get_value().split(`\\n`).filter(s => s);\n\t\t\tif (!selected_serial_nos.length) return;\n\n\t\t\t// find batch nos of the selected serial no\n\t\t\tconst serials_with_batch_no = await frappe.db.get_list(\"Serial No\", {\n\t\t\t\tfilters: { 'name': [\"in\", selected_serial_nos]},\n\t\t\t\tfields: [\"batch_no\", \"name\"]\n\t\t\t});\n\t\t\tconst batch_serial_map = serials_with_batch_no.reduce((acc, r) => {\n\t\t\t\tif (!acc[r.batch_no]) {\n\t\t\t\t\tacc[r.batch_no] = [];\n\t\t\t\t}\n\t\t\t\tacc[r.batch_no] = [...acc[r.batch_no], r.name];\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t\t// set current item's batch no and serial no\n\t\t\tconst batch_no = Object.keys(batch_serial_map)[0];\n\t\t\tconst batch_serial_nos = batch_serial_map[batch_no].join(`\\n`);\n\t\t\t// eg. 10 selected serial no. -> 5 belongs to first batch other 5 belongs to second batch\n\t\t\tconst serial_nos_belongs_to_other_batch = selected_serial_nos.length !== batch_serial_map[batch_no].length;\n\n\t\t\tconst current_batch_no = this.batch_no_control.get_value();\n\t\t\tcurrent_batch_no != batch_no && await this.batch_no_control.set_value(batch_no);\n\n\t\t\tif (serial_nos_belongs_to_other_batch) {\n\t\t\t\tthis.serial_no_control.set_value(batch_serial_nos);\n\t\t\t\tthis.qty_control.set_value(batch_serial_map[batch_no].length);\n\n\t\t\t\tdelete batch_serial_map[batch_no];\n\t\t\t\tthis.events.clone_new_batch_item_in_frm(batch_serial_map, this.current_item);\n\t\t\t}\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tthis.bind_auto_serial_fetch_event();\n\t\tthis.bind_fields_to_numpad_fields();\n\n\t\tthis.$component.on('click', '.close-btn', () => {\n\t\t\tthis.events.close_item_details();\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tthis.wrapper.find('.close-btn').attr(\"title\", \"Esc\");\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_details_visible = this.$component.is(\":visible\");\n\t\t\tif (item_details_visible) {\n\t\t\t\tthis.events.close_item_details();\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_fields_to_numpad_fields() {\n\t\tconst me = this;\n\t\tthis.$form_container.on('click', '.input-with-feedback', function() {\n\t\t\tconst fieldname = $(this).attr('data-fieldname');\n\t\t\tif (this.last_field_focused != fieldname) {\n\t\t\t\tme.events.item_field_focused(fieldname);\n\t\t\t\tthis.last_field_focused = fieldname;\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_auto_serial_fetch_event() {\n\t\tthis.$form_container.on('click', '.auto-fetch-btn', () => {\n\t\t\tthis.batch_no_control && this.batch_no_control.set_value('');\n\t\t\tlet qty = this.qty_control.get_value();\n\t\t\tlet conversion_factor = this.conversion_factor_control.get_value();\n\t\t\tlet expiry_date = this.item_row.has_batch_no ? this.events.get_frm().doc.posting_date : \"\";\n\n\t\t\tlet numbers = frappe.call({\n\t\t\t\tmethod: \"erpnext.stock.doctype.serial_no.serial_no.auto_fetch_serial_number\",\n\t\t\t\targs: {\n\t\t\t\t\tqty: qty * conversion_factor,\n\t\t\t\t\titem_code: this.current_item.item_code,\n\t\t\t\t\twarehouse: this.warehouse_control.get_value() || '',\n\t\t\t\t\tbatch_nos: this.current_item.batch_no || '',\n\t\t\t\t\tposting_date: expiry_date,\n\t\t\t\t\tfor_doctype: 'POS Invoice'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tnumbers.then((data) => {\n\t\t\t\tlet auto_fetched_serial_numbers = data.message;\n\t\t\t\tlet records_length = auto_fetched_serial_numbers.length;\n\t\t\t\tif (!records_length) {\n\t\t\t\t\tconst warehouse = this.warehouse_control.get_value().bold();\n\t\t\t\t\tconst item_code = this.current_item.item_code.bold();\n\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t__('Serial numbers unavailable for Item {0} under warehouse {1}. Please try changing warehouse.', [item_code, warehouse])\n\t\t\t\t\t);\n\t\t\t\t} else if (records_length < qty) {\n\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t__('Fetched only {0} available serial numbers.', [records_length])\n\t\t\t\t\t);\n\t\t\t\t\tthis.qty_control.set_value(records_length);\n\t\t\t\t}\n\t\t\t\tnumbers = auto_fetched_serial_numbers.join(`\\n`);\n\t\t\t\tthis.serial_no_control.set_value(numbers);\n\t\t\t});\n\t\t})\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n}\n","erpnext.PointOfSale.NumberPad = class {\n\tconstructor({ wrapper, events, cols, keys, css_classes, fieldnames_map }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.cols = cols;\n\t\tthis.keys = keys;\n\t\tthis.css_classes = css_classes || [];\n\t\tthis.fieldnames = fieldnames_map || {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tconst { cols, keys, css_classes, fieldnames } = this;\n\n\t\tfunction get_keys() {\n\t\t\treturn keys.reduce((a, row, i) => {\n\t\t\t\treturn a + row.reduce((a2, number, j) => {\n\t\t\t\t\tconst class_to_append = css_classes && css_classes[i] ? css_classes[i][j] : '';\n\t\t\t\t\tconst fieldname = fieldnames && fieldnames[number] ?\n\t\t\t\t\t\tfieldnames[number] : typeof number === 'string' ? frappe.scrub(number) : number;\n\n\t\t\t\t\treturn a2 + `<div class=\"numpad-btn ${class_to_append}\" data-button-value=\"${fieldname}\">${number}</div>`;\n\t\t\t\t}, '');\n\t\t\t}, '');\n\t\t}\n\n\t\tthis.wrapper.html(\n\t\t\t`<div class=\"numpad-container\">\n\t\t\t\t${get_keys()}\n\t\t\t</div>`\n\t\t)\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.wrapper.on('click', '.numpad-btn', function() {\n\t\t\tconst $btn = $(this);\n\t\t\tme.events.numpad_event($btn);\n\t\t});\n\t}\n}\n","/* eslint-disable no-unused-vars */\nerpnext.PointOfSale.Payment = class {\n\tconstructor({ events, wrapper }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.initialize_numpad();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"payment-container\">\n\t\t\t\t<div class=\"section-label payment-section\">Payment Method</div>\n\t\t\t\t<div class=\"payment-modes\"></div>\n\t\t\t\t<div class=\"fields-numpad-container\">\n\t\t\t\t\t<div class=\"fields-section\">\n\t\t\t\t\t\t<div class=\"section-label\">Additional Information</div>\n\t\t\t\t\t\t<div class=\"invoice-fields\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"number-pad\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"totals-section\">\n\t\t\t\t\t<div class=\"totals\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"submit-order-btn\">Complete Order</div>\n\t\t\t</section>`\n\t\t);\n\t\tthis.$component = this.wrapper.find('.payment-container');\n\t\tthis.$payment_modes = this.$component.find('.payment-modes');\n\t\tthis.$totals_section = this.$component.find('.totals-section');\n\t\tthis.$totals = this.$component.find('.totals');\n\t\tthis.$numpad = this.$component.find('.number-pad');\n\t\tthis.$invoice_fields_section = this.$component.find('.fields-section');\n\t}\n\n\tmake_invoice_fields_control() {\n\t\tfrappe.db.get_doc(\"POS Settings\", undefined).then((doc) => {\n\t\t\tconst fields = doc.invoice_fields;\n\t\t\tif (!fields.length) return;\n\n\t\t\tthis.$invoice_fields = this.$invoice_fields_section.find('.invoice-fields');\n\t\t\tthis.$invoice_fields.html('');\n\t\t\tconst frm = this.events.get_frm();\n\n\t\t\tfields.forEach(df => {\n\t\t\t\tthis.$invoice_fields.append(\n\t\t\t\t\t`<div class=\"invoice_detail_field ${df.fieldname}-field\" data-fieldname=\"${df.fieldname}\"></div>`\n\t\t\t\t);\n\t\t\t\tlet df_events = {\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tfrm.set_value(this.df.fieldname, this.get_value());\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (df.fieldtype == \"Button\") {\n\t\t\t\t\tdf_events = {\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\tif (frm.script_manager.has_handlers(df.fieldname, frm.doc.doctype)) {\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(df.fieldname, frm.doc.doctype, frm.doc.docname);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis[`${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\t...df,\n\t\t\t\t\t\t...df_events\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$invoice_fields.find(`.${df.fieldname}-field`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tthis[`${df.fieldname}_field`].set_value(frm.doc[df.fieldname]);\n\t\t\t});\n\t\t});\n\t}\n\n\tinitialize_numpad() {\n\t\tconst me = this;\n\t\tthis.number_pad = new erpnext.PointOfSale.NumberPad({\n\t\t\twrapper: this.$numpad,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: function($btn) {\n\t\t\t\t\tme.on_numpad_clicked($btn);\n\t\t\t\t}\n\t\t\t},\n\t\t\tcols: 3,\n\t\t\tkeys: [\n\t\t\t\t[ 1, 2, 3 ],\n\t\t\t\t[ 4, 5, 6 ],\n\t\t\t\t[ 7, 8, 9 ],\n\t\t\t\t[ '.', 0, 'Delete' ]\n\t\t\t],\n\t\t});\n\n\t\tthis.numpad_value = '';\n\t}\n\n\ton_numpad_clicked($btn) {\n\t\tconst button_value = $btn.attr('data-button-value');\n\n\t\thighlight_numpad_btn($btn);\n\t\tthis.numpad_value = button_value === 'delete' ? this.numpad_value.slice(0, -1) : this.numpad_value + button_value;\n\t\tthis.selected_mode.$input.get(0).focus();\n\t\tthis.selected_mode.set_value(this.numpad_value);\n\n\t\tfunction highlight_numpad_btn($btn) {\n\t\t\t$btn.addClass('shadow-base-inner bg-selected');\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass('shadow-base-inner bg-selected');\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\n\t\tthis.$payment_modes.on('click', '.mode-of-payment', function(e) {\n\t\t\tconst mode_clicked = $(this);\n\t\t\t// if clicked element doesn't have .mode-of-payment class then return\n\t\t\tif (!$(e.target).is(mode_clicked)) return;\n\n\t\t\tconst scrollLeft = mode_clicked.offset().left - me.$payment_modes.offset().left + me.$payment_modes.scrollLeft();\n\t\t\tme.$payment_modes.animate({ scrollLeft });\n\n\t\t\tconst mode = mode_clicked.attr('data-mode');\n\n\t\t\t// hide all control fields and shortcuts\n\t\t\t$(`.mode-of-payment-control`).css('display', 'none');\n\t\t\t$(`.cash-shortcuts`).css('display', 'none');\n\t\t\tme.$payment_modes.find(`.pay-amount`).css('display', 'inline');\n\t\t\tme.$payment_modes.find(`.loyalty-amount-name`).css('display', 'none');\n\n\t\t\t// remove highlight from all mode-of-payments\n\t\t\t$('.mode-of-payment').removeClass('border-primary');\n\n\t\t\tif (mode_clicked.hasClass('border-primary')) {\n\t\t\t\t// clicked one is selected then unselect it\n\t\t\t\tmode_clicked.removeClass('border-primary');\n\t\t\t\tme.selected_mode = '';\n\t\t\t} else {\n\t\t\t\t// clicked one is not selected then select it\n\t\t\t\tmode_clicked.addClass('border-primary');\n\t\t\t\tmode_clicked.find('.mode-of-payment-control').css('display', 'flex');\n\t\t\t\tmode_clicked.find('.cash-shortcuts').css('display', 'grid');\n\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).css('display', 'none');\n\t\t\t\tme.$payment_modes.find(`.${mode}-name`).css('display', 'inline');\n\n\t\t\t\tme.selected_mode = me[`${mode}_control`];\n\t\t\t\tme.selected_mode && me.selected_mode.$input.get(0).focus();\n\t\t\t\tme.auto_set_remaining_amount();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'contact_mobile', (frm) => {\n\t\t\tconst contact = frm.doc.contact_mobile;\n\t\t\tconst request_button = $(this.request_for_payment_field.$input[0]);\n\t\t\tif (contact) {\n\t\t\t\trequest_button.removeClass('btn-default').addClass('btn-primary');\n\t\t\t} else {\n\t\t\t\trequest_button.removeClass('btn-primary').addClass('btn-default');\n      }\n    });\n\n\t\tthis.setup_listener_for_payments();\n\n\t\tthis.$payment_modes.on('click', '.shortcut', function() {\n\t\t\tconst value = $(this).attr('data-value');\n\t\t\tme.selected_mode.set_value(value);\n\t\t});\n\n\t\tthis.$component.on('click', '.submit-order-btn', () => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst paid_amount = doc.paid_amount;\n\t\t\tconst items = doc.items;\n\n\t\t\tif (paid_amount == 0 || !items.length) {\n\t\t\t\tconst message = items.length ? __(\"You cannot submit the order without payment.\") : __(\"You cannot submit empty order.\");\n\t\t\t\tfrappe.show_alert({ message, indicator: \"orange\" });\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.events.submit_invoice();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'paid_amount', (frm) => {\n\t\t\tthis.update_totals_section(frm.doc);\n\n\t\t\t// need to re calculate cash shortcuts after discount is applied\n\t\t\tconst is_cash_shortcuts_invisible = !this.$payment_modes.find('.cash-shortcuts').is(':visible');\n\t\t\tthis.attach_cash_shortcuts(frm.doc);\n\t\t\t!is_cash_shortcuts_invisible && this.$payment_modes.find('.cash-shortcuts').css('display', 'grid');\n\t\t\tthis.render_payment_mode_dom();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'loyalty_amount', (frm) => {\n\t\t\tconst formatted_currency = format_currency(frm.doc.loyalty_amount, frm.doc.currency);\n\t\t\tthis.$payment_modes.find(`.loyalty-amount-amount`).html(formatted_currency);\n\t\t});\n\n\t\tfrappe.ui.form.on(\"Sales Invoice Payment\", \"amount\", (frm, cdt, cdn) => {\n\t\t\t// for setting correct amount after loyalty points are redeemed\n\t\t\tconst default_mop = locals[cdt][cdn];\n\t\t\tconst mode = default_mop.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (this[`${mode}_control`] && this[`${mode}_control`].get_value() != default_mop.amount) {\n\t\t\t\tthis[`${mode}_control`].set_value(default_mop.amount);\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_listener_for_payments() {\n\t\tfrappe.realtime.on(\"process_phone_payment\", (data) => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst { response, amount, success, failure_message } = data;\n\t\t\tlet message, title;\n\n\t\t\tif (success) {\n\t\t\t\ttitle = __(\"Payment Received\");\n\t\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\t\t\tif (amount >= grand_total) {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully.\", [format_currency(amount, doc.currency, 0)]);\n\t\t\t\t\tthis.events.submit_invoice();\n\t\t\t\t\tcur_frm.reload_doc();\n\n\t\t\t\t} else {\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully. Waiting for other requests to complete...\", [format_currency(amount, doc.currency, 0)]);\n\t\t\t\t}\n\t\t\t} else if (failure_message) {\n\t\t\t\tmessage = failure_message;\n\t\t\t\ttitle = __(\"Payment Failed\");\n\t\t\t}\n\n\t\t\tfrappe.msgprint({ \"message\": message, \"title\": title });\n\t\t});\n\t}\n\n\tauto_set_remaining_amount() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst remaining_amount = grand_total - doc.paid_amount;\n\t\tconst current_value = this.selected_mode ? this.selected_mode.get_value() : undefined;\n\t\tif (!current_value && remaining_amount > 0 && this.selected_mode) {\n\t\t\tthis.selected_mode.set_value(remaining_amount);\n\t\t}\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '⌘' : 'Ctrl';\n\t\tthis.$component.find('.submit-order-btn').attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\tconst active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\tif (payment_is_visible && active_mode.length) {\n\t\t\t\tthis.$component.find('.submit-order-btn').click();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"tab\",\n\t\t\taction: () => {\n\t\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\t\tlet active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\t\tactive_mode = active_mode.length ? active_mode.attr(\"data-mode\") : undefined;\n\n\t\t\t\tif (!active_mode) return;\n\n\t\t\t\tconst mode_of_payments = Array.from(this.$payment_modes.find(\".mode-of-payment\")).map(m => $(m).attr(\"data-mode\"));\n\t\t\t\tconst mode_index = mode_of_payments.indexOf(active_mode);\n\t\t\t\tconst next_mode_index = (mode_index + 1) % mode_of_payments.length;\n\t\t\t\tconst next_mode_to_be_clicked = this.$payment_modes.find(`.mode-of-payment[data-mode=\"${mode_of_payments[next_mode_index]}\"]`);\n\n\t\t\t\tif (payment_is_visible && mode_index != next_mode_index) {\n\t\t\t\t\tnext_mode_to_be_clicked.click();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcondition: () => this.$component.is(':visible') && this.$payment_modes.find(\".border-primary\").length,\n\t\t\tdescription: __(\"Switch Between Payment Modes\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t}\n\n\ttoggle_numpad() {\n\t\t// pass\n\t}\n\n\trender_payment_section() {\n\t\tthis.render_payment_mode_dom();\n\t\tthis.make_invoice_fields_control();\n\t\tthis.update_totals_section();\n\t\tthis.focus_on_default_mop();\n\t}\n\n\tedit_cart() {\n\t\tthis.events.toggle_other_sections(false);\n\t\tthis.toggle_component(false);\n\t}\n\n\tcheckout() {\n\t\tthis.events.toggle_other_sections(true);\n\t\tthis.toggle_component(true);\n\n\t\tthis.render_payment_section();\n\t}\n\n\ttoggle_remarks_control() {\n\t\tif (this.$remarks.find('.frappe-control').length) {\n\t\t\tthis.$remarks.html('+ Add Remark');\n\t\t} else {\n\t\t\tthis.$remarks.html('');\n\t\t\tthis[`remark_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Remark'),\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tonchange: function() {}\n\t\t\t\t},\n\t\t\t\tparent: this.$totals_section.find(`.remarks`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`remark_control`].set_value('');\n\t\t}\n\t}\n\n\trender_payment_mode_dom() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tconst currency = doc.currency;\n\n\t\tthis.$payment_modes.html(`${\n\t\t\tpayments.map((p, i) => {\n\t\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\t\tconst payment_type = p.type;\n\t\t\t\tconst margin = i % 2 === 0 ? 'pr-2' : 'pl-2';\n\t\t\t\tconst amount = p.amount > 0 ? format_currency(p.amount, currency) : '';\n\n\t\t\t\treturn (`\n\t\t\t\t\t<div class=\"payment-mode-wrapper\">\n\t\t\t\t\t\t<div class=\"mode-of-payment\" data-mode=\"${mode}\" data-payment-type=\"${payment_type}\">\n\t\t\t\t\t\t\t${p.mode_of_payment}\n\t\t\t\t\t\t\t<div class=\"${mode}-amount pay-amount\">${amount}</div>\n\t\t\t\t\t\t\t<div class=\"${mode} mode-of-payment-control\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`);\n\t\t\t}).join('')\n\t\t}`);\n\n\t\tpayments.forEach(p => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tconst me = this;\n\t\t\tthis[`${mode}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: p.mode_of_payment,\n\t\t\t\t\tfieldtype: 'Currency',\n\t\t\t\t\tplaceholder: __('Enter {0} amount.', [p.mode_of_payment]),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst current_value = frappe.model.get_value(p.doctype, p.name, 'amount');\n\t\t\t\t\t\tif (current_value != this.value) {\n\t\t\t\t\t\t\tfrappe.model\n\t\t\t\t\t\t\t\t.set_value(p.doctype, p.name, 'amount', flt(this.value))\n\t\t\t\t\t\t\t\t.then(() => me.update_totals_section())\n\n\t\t\t\t\t\t\tconst formatted_currency = format_currency(this.value, currency);\n\t\t\t\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).html(formatted_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tparent: this.$payment_modes.find(`.${mode}.mode-of-payment-control`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`${mode}_control`].toggle_label(false);\n\t\t\tthis[`${mode}_control`].set_value(p.amount);\n\t\t});\n\n\t\tthis.render_loyalty_points_payment_mode();\n\n\t\tthis.attach_cash_shortcuts(doc);\n\t}\n\n\tfocus_on_default_mop() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tpayments.forEach(p => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (p.default) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$payment_modes.find(`.${mode}.mode-of-payment-control`).parent().click();\n\t\t\t\t}, 500);\n\t\t\t}\n\t\t});\n\t}\n\n\tattach_cash_shortcuts(doc) {\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst currency = doc.currency;\n\n\t\tconst shortcuts = this.get_cash_shortcuts(flt(grand_total));\n\n\t\tthis.$payment_modes.find('.cash-shortcuts').remove();\n\t\tlet shortcuts_html = shortcuts.map(s => {\n\t\t\treturn `<div class=\"shortcut\" data-value=\"${s}\">${format_currency(s, currency, 0)}</div>`;\n\t\t}).join('');\n\n\t\tthis.$payment_modes.find('[data-payment-type=\"Cash\"]').find('.mode-of-payment-control')\n\t\t\t.after(`<div class=\"cash-shortcuts\">${shortcuts_html}</div>`);\n\t}\n\n\tget_cash_shortcuts(grand_total) {\n\t\tlet steps = [1, 5, 10];\n\t\tconst digits = String(Math.round(grand_total)).length;\n\n\t\tsteps = steps.map(x => x * (10 ** (digits - 2)));\n\n\t\tconst get_nearest = (amount, x) => {\n\t\t\tlet nearest_x = Math.ceil((amount / x)) * x;\n\t\t\treturn nearest_x === amount ? nearest_x + x : nearest_x;\n\t\t};\n\n\t\treturn steps.reduce((finalArr, x) => {\n\t\t\tlet nearest_x = get_nearest(grand_total, x);\n\t\t\tnearest_x = finalArr.indexOf(nearest_x) != -1 ? nearest_x + x : nearest_x;\n\t\t\treturn [...finalArr, nearest_x];\n\t\t}, []);\n\t}\n\n\trender_loyalty_points_payment_mode() {\n\t\tconst me = this;\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst { loyalty_program, loyalty_points, conversion_factor } = this.events.get_customer_details();\n\n\t\tthis.$payment_modes.find(`.mode-of-payment[data-mode=\"loyalty-amount\"]`).parent().remove();\n\n\t\tif (!loyalty_program) return;\n\n\t\tlet description, read_only, max_redeemable_amount;\n\t\tif (!loyalty_points) {\n\t\t\tdescription = __(\"You don't have enough points to redeem.\");\n\t\t\tread_only = true;\n\t\t} else {\n\t\t\tmax_redeemable_amount = flt(flt(loyalty_points) * flt(conversion_factor), precision(\"loyalty_amount\", doc));\n\t\t\tdescription = __(\"You can redeem upto {0}.\", [format_currency(max_redeemable_amount)]);\n\t\t\tread_only = false;\n\t\t}\n\n\t\tconst margin = this.$payment_modes.children().length % 2 === 0 ? 'pr-2' : 'pl-2';\n\t\tconst amount = doc.loyalty_amount > 0 ? format_currency(doc.loyalty_amount, doc.currency) : '';\n\t\tthis.$payment_modes.append(\n\t\t\t`<div class=\"payment-mode-wrapper\">\n\t\t\t\t<div class=\"mode-of-payment loyalty-card\" data-mode=\"loyalty-amount\" data-payment-type=\"loyalty-amount\">\n\t\t\t\t\tRedeem Loyalty Points\n\t\t\t\t\t<div class=\"loyalty-amount-amount pay-amount\">${amount}</div>\n\t\t\t\t\t<div class=\"loyalty-amount-name\">${loyalty_program}</div>\n\t\t\t\t\t<div class=\"loyalty-amount mode-of-payment-control\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\n\t\tthis['loyalty-amount_control'] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Redeem Loyalty Points\"),\n\t\t\t\tfieldtype: 'Currency',\n\t\t\t\tplaceholder: __(\"Enter amount to be redeemed.\"),\n\t\t\t\toptions: 'company:currency',\n\t\t\t\tread_only,\n\t\t\t\tonchange: async function() {\n\t\t\t\t\tif (!loyalty_points) return;\n\n\t\t\t\t\tif (this.value > max_redeemable_amount) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"You cannot redeem more than {0}.\", [format_currency(max_redeemable_amount)]),\n\t\t\t\t\t\t\tindicator: \"red\"\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tme['loyalty-amount_control'].set_value(0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst redeem_loyalty_points = this.value > 0 ? 1 : 0;\n\t\t\t\t\tawait frappe.model.set_value(doc.doctype, doc.name, 'redeem_loyalty_points', redeem_loyalty_points);\n\t\t\t\t\tfrappe.model.set_value(doc.doctype, doc.name, 'loyalty_points', parseInt(this.value / conversion_factor));\n\t\t\t\t},\n\t\t\t\tdescription\n\t\t\t},\n\t\t\tparent: this.$payment_modes.find(`.loyalty-amount.mode-of-payment-control`),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis['loyalty-amount_control'].toggle_label(false);\n\n\t\t// this.render_add_payment_method_dom();\n\t}\n\n\trender_add_payment_method_dom() {\n\t\tconst docstatus = this.events.get_frm().doc.docstatus;\n\t\tif (docstatus === 0)\n\t\t\tthis.$payment_modes.append(\n\t\t\t\t`<div class=\"w-full pr-2\">\n\t\t\t\t\t<div class=\"add-mode-of-payment w-half text-grey mb-4 no-select pointer\">+ Add Payment Method</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t}\n\n\tupdate_totals_section(doc) {\n\t\tif (!doc) doc = this.events.get_frm().doc;\n\t\tconst paid_amount = doc.paid_amount;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst remaining = grand_total - doc.paid_amount;\n\t\tconst change = doc.change_amount || remaining <= 0 ? -1 * remaining : undefined;\n\t\tconst currency = doc.currency;\n\t\tconst label = change ? __('Change') : __('To Be Paid');\n\n\t\tthis.$totals.html(\n\t\t\t`<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">Grand Total</div>\n\t\t\t\t<div class=\"value\">${format_currency(grand_total, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">Paid Amount</div>\n\t\t\t\t<div class=\"value\">${format_currency(paid_amount, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${label}</div>\n\t\t\t\t<div class=\"value\">${format_currency(change || remaining, currency)}</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n};\n","erpnext.PointOfSale.PastOrderList = class {\n\tconstructor({ wrapper, events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.make_filter_section();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-list\">\n\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t<div class=\"label\">Recent Orders</div>\n\t\t\t\t\t<div class=\"search-field\"></div>\n\t\t\t\t\t<div class=\"status-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoices-container\"></div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-list');\n\t\tthis.$invoices_container = this.$component.find('.invoices-container');\n\t}\n\n\tbind_events() {\n\t\tthis.search_field.$input.on('input', (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.refresh_list(search_term, this.status_field.get_value());\n\t\t\t}, 300);\n\t\t});\n\t\tconst me = this;\n\t\tthis.$invoices_container.on('click', '.invoice-wrapper', function() {\n\t\t\tconst invoice_name = unescape($(this).attr('data-invoice-name'));\n\n\t\t\tme.events.open_invoice_data(invoice_name);\n\t\t});\n\t}\n\n\tmake_filter_section() {\n\t\tconst me = this;\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Search'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: __('Search by invoice id or customer name')\n\t\t\t},\n\t\t\tparent: this.$component.find('.search-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.status_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Invoice Status'),\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\toptions: `Draft\\nPaid\\nConsolidated\\nReturn`,\n\t\t\t\tplaceholder: __('Filter by invoice status'),\n\t\t\t\tonchange: function() {\n\t\t\t\t\tif (me.$component.is(':visible')) me.refresh_list();\n\t\t\t\t}\n\t\t\t},\n\t\t\tparent: this.$component.find('.status-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.status_field.toggle_label(false);\n\t\tthis.status_field.set_value('Draft');\n\t}\n\n\trefresh_list() {\n\t\tfrappe.dom.freeze();\n\t\tthis.events.reset_summary();\n\t\tconst search_term = this.search_field.get_value();\n\t\tconst status = this.status_field.get_value();\n\n\t\tthis.$invoices_container.html('');\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_past_order_list\",\n\t\t\tfreeze: true,\n\t\t\targs: { search_term, status },\n\t\t\tcallback: (response) => {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tresponse.message.forEach(invoice => {\n\t\t\t\t\tconst invoice_html = this.get_invoice_html(invoice);\n\t\t\t\t\tthis.$invoices_container.append(invoice_html);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget_invoice_html(invoice) {\n\t\tconst posting_datetime = moment(invoice.posting_date+\" \"+invoice.posting_time).format(\"Do MMMM, h:mma\");\n\t\treturn (\n\t\t\t`<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t<div class=\"invoice-date\">\n\t\t\t\t\t\t<svg class=\"mr-2\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n\t\t\t\t\t\t\t<path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t${frappe.ellipsis(invoice.customer, 20)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t<div class=\"invoice-total\">${format_currency(invoice.grand_total, invoice.currency, 0) || 0}</div>\n\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator\"></div>`\n\t\t);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') && this.refresh_list() : this.$component.css('display', 'none');\n\t}\n};\n","erpnext.PointOfSale.PastOrderSummary = class {\n\tconstructor({ wrapper, events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_email_print_dialog();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-summary\">\n\t\t\t\t<div class=\"no-summary-placeholder\">\n\t\t\t\t\tSelect an invoice to load summary data\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-summary-wrapper\">\n\t\t\t\t\t<div class=\"abs-container\">\n\t\t\t\t\t\t<div class=\"upper-section\"></div>\n\t\t\t\t\t\t<div class=\"label\">Items</div>\n\t\t\t\t\t\t<div class=\"items-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">Totals</div>\n\t\t\t\t\t\t<div class=\"totals-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">Payments</div>\n\t\t\t\t\t\t<div class=\"payments-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"summary-btns\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-summary');\n\t\tthis.$summary_wrapper = this.$component.find('.invoice-summary-wrapper');\n\t\tthis.$summary_container = this.$component.find('.abs-container');\n\t\tthis.$upper_section = this.$summary_container.find('.upper-section');\n\t\tthis.$items_container = this.$summary_container.find('.items-container');\n\t\tthis.$totals_container = this.$summary_container.find('.totals-container');\n\t\tthis.$payment_container = this.$summary_container.find('.payments-container');\n\t\tthis.$summary_btns = this.$summary_container.find('.summary-btns');\n\t}\n\n\tinit_email_print_dialog() {\n\t\tconst email_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Email Receipt',\n\t\t\tfields: [\n\t\t\t\t{fieldname: 'email_id', fieldtype: 'Data', options: 'Email', label: 'Email ID'},\n\t\t\t\t// {fieldname:'remarks', fieldtype:'Text', label:'Remarks (if any)'}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.send_email();\n\t\t\t},\n\t\t\tprimary_action_label: __('Send'),\n\t\t});\n\t\tthis.email_dialog = email_dialog;\n\n\t\tconst print_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Print Receipt',\n\t\t\tfields: [\n\t\t\t\t{fieldname: 'print', fieldtype: 'Data', label: 'Print Preview'}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.print_receipt();\n\t\t\t},\n\t\t\tprimary_action_label: __('Print'),\n\t\t});\n\t\tthis.print_dialog = print_dialog;\n\t}\n\n\tget_upper_section_html(doc) {\n\t\tconst { status } = doc;\n\t\tlet indicator_color = '';\n\n\t\tin_list(['Paid', 'Consolidated'], status) && (indicator_color = 'green');\n\t\tstatus === 'Draft' && (indicator_color = 'red');\n\t\tstatus === 'Return' && (indicator_color = 'grey');\n\n\t\treturn `<div class=\"left-section\">\n\t\t\t\t\t<div class=\"customer-name\">${doc.customer}</div>\n\t\t\t\t\t<div class=\"customer-email\">${this.customer_email}</div>\n\t\t\t\t\t<div class=\"cashier\">Sold by: ${doc.owner}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"right-section\">\n\t\t\t\t\t<div class=\"paid-amount\">${format_currency(doc.paid_amount, doc.currency)}</div>\n\t\t\t\t\t<div class=\"invoice-name\">${doc.name}</div>\n\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\"><span>${doc.status}</span></span>\n\t\t\t\t</div>`;\n\t}\n\n\tget_item_html(doc, item_data) {\n\t\treturn `<div class=\"item-row-wrapper\">\n\t\t\t\t\t<div class=\"item-name\">${item_data.item_name}</div>\n\t\t\t\t\t<div class=\"item-qty\">${item_data.qty || 0}</div>\n\t\t\t\t\t<div class=\"item-rate-disc\">${get_rate_discount_html()}</div>\n\t\t\t\t</div>`;\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (item_data.rate && item_data.price_list_rate && item_data.rate !== item_data.price_list_rate) {\n\t\t\t\treturn `<span class=\"item-disc\">(${item_data.discount_percentage}% off)</span>\n\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.rate, doc.currency)}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-rate\">${format_currency(item_data.price_list_rate || item_data.rate, doc.currency)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\tget_discount_html(doc) {\n\t\tif (doc.discount_amount) {\n\t\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t\t<div>Discount (${doc.additional_discount_percentage} %)</div>\n\t\t\t\t\t\t<div>${format_currency(doc.discount_amount, doc.currency)}</div>\n\t\t\t\t\t</div>`;\n\t\t} else {\n\t\t\treturn ``;\n\t\t}\n\t}\n\n\tget_net_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t<div>Net Total</div>\n\t\t\t\t\t<div>${format_currency(doc.net_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_taxes_html(doc) {\n\t\tif (!doc.taxes.length) return '';\n\n\t\tlet taxes_html = doc.taxes.map(t => {\n\t\t\tconst description = /[0-9]+/.test(t.description) ? t.description : `${t.description} @ ${t.rate}%`;\n\t\t\treturn `\n\t\t\t\t<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, doc.currency)}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}).join('');\n\n\t\treturn `<div class=\"taxes-wrapper\">${taxes_html}</div>`;\n\t}\n\n\tget_grand_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper grand-total\">\n\t\t\t\t\t<div>Grand Total</div>\n\t\t\t\t\t<div>${format_currency(doc.grand_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_payment_html(doc, payment) {\n\t\treturn `<div class=\"summary-row-wrapper payments\">\n\t\t\t\t\t<div>${payment.mode_of_payment}</div>\n\t\t\t\t\t<div>${format_currency(payment.amount, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tbind_events() {\n\t\tthis.$summary_container.on('click', '.return-btn', () => {\n\t\t\tthis.events.process_return(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.edit-btn', () => {\n\t\t\tthis.events.edit_order(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t\t// this.toggle_component(false);\n\t\t\t// this.$component.find('.no-summary-placeholder').removeClass('d-none');\n\t\t\t// this.$summary_wrapper.addClass('d-none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.new-btn', () => {\n\t\t\tthis.events.new_order();\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.email-btn', () => {\n\t\t\tthis.email_dialog.fields_dict.email_id.set_value(this.customer_email);\n\t\t\tthis.email_dialog.show();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.print-btn', () => {\n\t\t\tthis.print_receipt();\n\t\t});\n\t}\n\n\tprint_receipt() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrappe.utils.print(\n\t\t\tthis.doc.doctype,\n\t\t\tthis.doc.name,\n\t\t\tfrm.pos_print_format,\n\t\t\tthis.doc.letter_head,\n\t\t\tthis.doc.language || frappe.boot.lang\n\t\t);\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '⌘' : 'Ctrl';\n\t\tthis.$summary_container.find('.print-btn').attr(\"title\", `${ctrl_label}+P`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+p\",\n\t\t\taction: () => this.$summary_container.find('.print-btn').click(),\n\t\t\tcondition: () => this.$component.is(':visible') && this.$summary_container.find('.print-btn').is(\":visible\"),\n\t\t\tdescription: __(\"Print Receipt\"),\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.$summary_container.find('.new-btn').attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst summary_is_visible = this.$component.is(\":visible\");\n\t\t\tif (summary_is_visible && this.$summary_container.find('.new-btn').is(\":visible\")) {\n\t\t\t\tthis.$summary_container.find('.new-btn').click();\n\t\t\t}\n\t\t});\n\t\tthis.$summary_container.find('.edit-btn').attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+e\",\n\t\t\taction: () => this.$summary_container.find('.edit-btn').click(),\n\t\t\tcondition: () => this.$component.is(':visible') && this.$summary_container.find('.edit-btn').is(\":visible\"),\n\t\t\tdescription: __(\"Edit Receipt\"),\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t}\n\n\tsend_email() {\n\t\tconst frm = this.events.get_frm();\n\t\tconst recipients = this.email_dialog.get_values().email_id;\n\t\tconst doc = this.doc || frm.doc;\n\t\tconst print_format = frm.pos_print_format;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.communication.email.make\",\n\t\t\targs: {\n\t\t\t\trecipients: recipients,\n\t\t\t\tsubject: __(frm.meta.name) + ': ' + doc.name,\n\t\t\t\tdoctype: doc.doctype,\n\t\t\t\tname: doc.name,\n\t\t\t\tsend_email: 1,\n\t\t\t\tprint_format,\n\t\t\t\tsender_full_name: frappe.user.full_name(),\n\t\t\t\t_lang: doc.language\n\t\t\t},\n\t\t\tcallback: r => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound(\"email\");\n\t\t\t\t\tif (r.message[\"emails_not_sent_to\"]) {\n\t\t\t\t\t\tfrappe.msgprint(__(\n\t\t\t\t\t\t\t\"Email not sent to {0} (unsubscribed / disabled)\",\n\t\t\t\t\t\t\t[ frappe.utils.escape_html(r.message[\"emails_not_sent_to\"]) ]\n\t\t\t\t\t\t));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __('Email sent successfully.'),\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.email_dialog.hide();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__(\"There were errors while sending email. Please try again.\"));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tadd_summary_btns(map) {\n\t\tthis.$summary_btns.html('');\n\t\tmap.forEach(m => {\n\t\t\tif (m.condition) {\n\t\t\t\tm.visible_btns.forEach(b => {\n\t\t\t\t\tconst class_name = b.split(' ')[0].toLowerCase();\n\t\t\t\t\tthis.$summary_btns.append(\n\t\t\t\t\t\t`<div class=\"summary-btn btn btn-default ${class_name}-btn\">${b}</div>`\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.$summary_btns.children().last().removeClass('mr-4');\n\t}\n\n\ttoggle_summary_placeholder(show) {\n\t\tif (show) {\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t} else {\n\t\t\tthis.$summary_wrapper.css('display', 'flex');\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'none');\n\t\t}\n\t}\n\n\tget_condition_btn_map(after_submission) {\n\t\tif (after_submission)\n\t\t\treturn [{ condition: true, visible_btns: ['Print Receipt', 'Email Receipt', 'New Order'] }];\n\n\t\treturn [\n\t\t\t{ condition: this.doc.docstatus === 0, visible_btns: ['Edit Order', 'Delete Order'] },\n\t\t\t{ condition: !this.doc.is_return && this.doc.docstatus === 1, visible_btns: ['Print Receipt', 'Email Receipt', 'Return']},\n\t\t\t{ condition: this.doc.is_return && this.doc.docstatus === 1, visible_btns: ['Print Receipt', 'Email Receipt']}\n\t\t];\n\t}\n\n\tload_summary_of(doc, after_submission=false) {\n\t\tafter_submission ?\n\t\t\tthis.$component.css('grid-column', 'span 10 / span 10') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tthis.toggle_summary_placeholder(false);\n\n\t\tthis.doc = doc;\n\n\t\tthis.attach_document_info(doc);\n\n\t\tthis.attach_items_info(doc);\n\n\t\tthis.attach_totals_info(doc);\n\n\t\tthis.attach_payments_info(doc);\n\n\t\tconst condition_btns_map = this.get_condition_btn_map(after_submission);\n\n\t\tthis.add_summary_btns(condition_btns_map);\n\t}\n\n\tattach_document_info(doc) {\n\t\tfrappe.db.get_value('Customer', this.doc.customer, 'email_id').then(({ message }) => {\n\t\t\tthis.customer_email = message.email_id || '';\n\t\t\tconst upper_section_dom = this.get_upper_section_html(doc);\n\t\t\tthis.$upper_section.html(upper_section_dom);\n\t\t});\n\t}\n\n\tattach_items_info(doc) {\n\t\tthis.$items_container.html('');\n\t\tdoc.items.forEach(item => {\n\t\t\tconst item_dom = this.get_item_html(doc, item);\n\t\t\tthis.$items_container.append(item_dom);\n\t\t\tthis.set_dynamic_rate_header_width();\n\t\t});\n\t}\n\n\tset_dynamic_rate_header_width() {\n\t\tconst rate_cols = Array.from(this.$items_container.find(\".item-rate-disc\"));\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", \"\");\n\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\tif ($(elm).width() > max_width)\n\t\t\t\tmax_width = $(elm).width();\n\t\t\treturn max_width;\n\t\t}, 0);\n\n\t\tmax_width += 1;\n\t\tif (max_width == 1) max_width = \"\";\n\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", max_width);\n\t}\n\n\tattach_payments_info(doc) {\n\t\tthis.$payment_container.html('');\n\t\tdoc.payments.forEach(p => {\n\t\t\tif (p.amount) {\n\t\t\t\tconst payment_dom = this.get_payment_html(doc, p);\n\t\t\t\tthis.$payment_container.append(payment_dom);\n\t\t\t}\n\t\t});\n\t\tif (doc.redeem_loyalty_points && doc.loyalty_amount) {\n\t\t\tconst payment_dom = this.get_payment_html(doc, {\n\t\t\t\tmode_of_payment: 'Loyalty Points',\n\t\t\t\tamount: doc.loyalty_amount,\n\t\t\t});\n\t\t\tthis.$payment_container.append(payment_dom);\n\t\t}\n\t}\n\n\tattach_totals_info(doc) {\n\t\tthis.$totals_container.html('');\n\n\t\tconst net_total_dom = this.get_net_total_html(doc);\n\t\tconst taxes_dom = this.get_taxes_html(doc);\n\t\tconst discount_dom = this.get_discount_html(doc);\n\t\tconst grand_total_dom = this.get_grand_total_html(doc);\n\t\tthis.$totals_container.append(net_total_dom);\n\t\tthis.$totals_container.append(taxes_dom);\n\t\tthis.$totals_container.append(discount_dom);\n\t\tthis.$totals_container.append(grand_total_dom);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n};\n","erpnext.PointOfSale.Controller = class {\n\tconstructor(wrapper) {\n\t\tthis.wrapper = $(wrapper).find('.layout-main-section');\n\t\tthis.page = wrapper.page;\n\n\t\tthis.check_opening_entry();\n\t}\n\n\tfetch_opening_entry() {\n\t\treturn frappe.call(\"erpnext.selling.page.point_of_sale.point_of_sale.check_opening_entry\", { \"user\": frappe.session.user });\n\t}\n\n\tcheck_opening_entry() {\n\t\tthis.fetch_opening_entry().then((r) => {\n\t\t\tif (r.message.length) {\n\t\t\t\t// assuming only one opening voucher is available for the current user\n\t\t\t\tthis.prepare_app_defaults(r.message[0]);\n\t\t\t} else {\n\t\t\t\tthis.create_opening_voucher();\n\t\t\t}\n\t\t});\n\t}\n\n\tcreate_opening_voucher() {\n\t\tconst me = this;\n\t\tconst table_fields = [\n\t\t\t{\n\t\t\t\tfieldname: \"mode_of_payment\", fieldtype: \"Link\",\n\t\t\t\tin_list_view: 1, label: \"Mode of Payment\",\n\t\t\t\toptions: \"Mode of Payment\", reqd: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"opening_amount\", fieldtype: \"Currency\",\n\t\t\t\tin_list_view: 1, label: \"Opening Amount\",\n\t\t\t\toptions: \"company:company_currency\",\n\t\t\t\tchange: function () {\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.some(d => {\n\t\t\t\t\t\tif (d.idx == this.doc.idx) {\n\t\t\t\t\t\t\td.opening_amount = this.value;\n\t\t\t\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst fetch_pos_payment_methods = () => {\n\t\t\tconst pos_profile = dialog.fields_dict.pos_profile.get_value();\n\t\t\tif (!pos_profile) return;\n\t\t\tfrappe.db.get_doc(\"POS Profile\", pos_profile).then(({ payments }) => {\n\t\t\t\tdialog.fields_dict.balance_details.df.data = [];\n\t\t\t\tpayments.forEach(pay => {\n\t\t\t\t\tconst { mode_of_payment } = pay;\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.push({ mode_of_payment, opening_amount: '0' });\n\t\t\t\t});\n\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t});\n\t\t}\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Create POS Opening Entry'),\n\t\t\tstatic: true,\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link', label: __('Company'), default: frappe.defaults.get_default('company'),\n\t\t\t\t\toptions: 'Company', fieldname: 'company', reqd: 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link', label: __('POS Profile'),\n\t\t\t\t\toptions: 'POS Profile', fieldname: 'pos_profile', reqd: 1,\n\t\t\t\t\tget_query: () => pos_profile_query,\n\t\t\t\t\tonchange: () => fetch_pos_payment_methods()\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"balance_details\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tlabel: \"Opening Balance Details\",\n\t\t\t\t\tcannot_add_rows: false,\n\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdata: [],\n\t\t\t\t\tfields: table_fields\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: async function({ company, pos_profile, balance_details }) {\n\t\t\t\tif (!balance_details.length) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Please add Mode of payments and opening balance details.\"),\n\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t})\n\t\t\t\t\treturn frappe.utils.play_sound(\"error\");\n\t\t\t\t}\n\n\t\t\t\t// filter balance details for empty rows\n\t\t\t\tbalance_details = balance_details.filter(d => d.mode_of_payment);\n\n\t\t\t\tconst method = \"erpnext.selling.page.point_of_sale.point_of_sale.create_opening_voucher\";\n\t\t\t\tconst res = await frappe.call({ method, args: { pos_profile, company, balance_details }, freeze:true });\n\t\t\t\t!res.exc && me.prepare_app_defaults(res.message);\n\t\t\t\tdialog.hide();\n\t\t\t},\n\t\t\tprimary_action_label: __('Submit')\n\t\t});\n\t\tdialog.show();\n\t\tconst pos_profile_query = {\n\t\t\tquery: 'erpnext.accounts.doctype.pos_profile.pos_profile.pos_profile_query',\n\t\t\tfilters: { company: dialog.fields_dict.company.get_value() }\n\t\t};\n\t}\n\n\tasync prepare_app_defaults(data) {\n\t\tthis.pos_opening = data.name;\n\t\tthis.company = data.company;\n\t\tthis.pos_profile = data.pos_profile;\n\t\tthis.pos_opening_time = data.period_start_date;\n\t\tthis.item_stock_map = {};\n\t\tthis.settings = {};\n\n\t\tfrappe.db.get_value('Stock Settings', undefined, 'allow_negative_stock').then(({ message }) => {\n\t\t\tthis.allow_negative_stock = flt(message.allow_negative_stock) || false;\n\t\t});\n\n\t\tfrappe.db.get_doc(\"POS Profile\", this.pos_profile).then((profile) => {\n\t\t\tObject.assign(this.settings, profile);\n\t\t\tthis.settings.customer_groups = profile.customer_groups.map(group => group.customer_group);\n\t\t\tthis.make_app();\n\t\t});\n\t}\n\n\tset_opening_entry_status() {\n\t\tthis.page.set_title_sub(\n\t\t\t`<span class=\"indicator orange\">\n\t\t\t\t<a class=\"text-muted\" href=\"#Form/POS%20Opening%20Entry/${this.pos_opening}\">\n\t\t\t\t\tOpened at ${moment(this.pos_opening_time).format(\"Do MMMM, h:mma\")}\n\t\t\t\t</a>\n\t\t\t</span>`);\n\t}\n\n\tmake_app() {\n\t\tthis.prepare_dom();\n\t\tthis.prepare_components();\n\t\tthis.prepare_menu();\n\t\tthis.make_new_invoice();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<div class=\"point-of-sale-app\"></div>`\n\t\t);\n\n\t\tthis.$components_wrapper = this.wrapper.find('.point-of-sale-app');\n\t}\n\n\tprepare_components() {\n\t\tthis.init_item_selector();\n\t\tthis.init_item_details();\n\t\tthis.init_item_cart();\n\t\tthis.init_payments();\n\t\tthis.init_recent_order_list();\n\t\tthis.init_order_summary();\n\t}\n\n\tprepare_menu() {\n\t\tthis.page.clear_menu();\n\n\t\tthis.page.add_menu_item(__(\"Open Form View\"), this.open_form_view.bind(this), false, 'Ctrl+F');\n\n\t\tthis.page.add_menu_item(__(\"Toggle Recent Orders\"), this.toggle_recent_order.bind(this), false, 'Ctrl+O');\n\n\t\tthis.page.add_menu_item(__(\"Save as Draft\"), this.save_draft_invoice.bind(this), false, 'Ctrl+S');\n\n\t\tthis.page.add_menu_item(__('Close the POS'), this.close_pos.bind(this), false, 'Shift+Ctrl+C');\n\t}\n\n\topen_form_view() {\n\t\tfrappe.model.sync(this.frm.doc);\n\t\tfrappe.set_route(\"Form\", this.frm.doc.doctype, this.frm.doc.name);\n\t}\n\n\ttoggle_recent_order() {\n\t\tconst show = this.recent_order_list.$component.is(':hidden');\n\t\tthis.toggle_recent_order_list(show);\n\t}\n\n\tsave_draft_invoice() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\tif (this.frm.doc.items.length == 0) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"You must add atleast one item to save it as draft.\"),\n\t\t\t\tindicator:'red'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm.save(undefined, undefined, undefined, () => {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"There was an error saving the document.\"),\n\t\t\t\tindicator: 'red'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t}).then(() => {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t]);\n\t\t});\n\t}\n\n\tclose_pos() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\tlet voucher = frappe.model.get_new_doc('POS Closing Entry');\n\t\tvoucher.pos_profile = this.frm.doc.pos_profile;\n\t\tvoucher.user = frappe.session.user;\n\t\tvoucher.company = this.frm.doc.company;\n\t\tvoucher.pos_opening_entry = this.pos_opening;\n\t\tvoucher.period_end_date = frappe.datetime.now_datetime();\n\t\tvoucher.posting_date = frappe.datetime.now_date();\n\t\tfrappe.set_route('Form', 'POS Closing Entry', voucher.name);\n\t}\n\n\tinit_item_selector() {\n\t\tthis.item_selector = new erpnext.PointOfSale.ItemSelector({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tpos_profile: this.pos_profile,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\titem_selected: args => this.on_cart_update(args),\n\n\t\t\t\tget_frm: () => this.frm || {}\n\t\t\t}\n\t\t})\n\t}\n\n\tinit_item_cart() {\n\t\tthis.cart = new erpnext.PointOfSale.ItemCart({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tcart_item_clicked: (item) => {\n\t\t\t\t\tconst item_row = this.get_item_from_frm(item);\n\t\t\t\t\tthis.item_details.toggle_item_details_section(item_row);\n\t\t\t\t},\n\n\t\t\t\tnumpad_event: (value, action) => this.update_item_field(value, action),\n\n\t\t\t\tcheckout: () => this.payment.checkout(),\n\n\t\t\t\tedit_cart: () => this.payment.edit_cart(),\n\n\t\t\t\tcustomer_details_updated: (details) => {\n\t\t\t\t\tthis.customer_details = details;\n\t\t\t\t\t// will add/remove LP payment method\n\t\t\t\t\tthis.payment.render_loyalty_points_payment_mode();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tinit_item_details() {\n\t\tthis.item_details = new erpnext.PointOfSale.ItemDetails({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\ttoggle_item_selector: (minimize) => {\n\t\t\t\t\tthis.item_selector.resize_selector(minimize);\n\t\t\t\t\tthis.cart.toggle_numpad(minimize);\n\t\t\t\t},\n\n\t\t\t\tform_updated: (item, field, value) => {\n\t\t\t\t\tconst item_row = frappe.model.get_doc(item.doctype, item.name);\n\t\t\t\t\tif (item_row && item_row[field] != value) {\n\t\t\t\t\t\tconst args = {\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\titem: this.item_details.current_item\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn this.on_cart_update(args);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t},\n\n\t\t\t\thighlight_cart_item: (item) => {\n\t\t\t\t\tconst cart_item = this.cart.get_cart_item(item);\n\t\t\t\t\tthis.cart.toggle_item_highlight(cart_item);\n\t\t\t\t},\n\n\t\t\t\titem_field_focused: (fieldname) => {\n\t\t\t\t\tthis.cart.toggle_numpad_field_edit(fieldname);\n\t\t\t\t},\n\t\t\t\tset_value_in_current_cart_item: (selector, value) => {\n\t\t\t\t\tthis.cart.update_selector_value_in_cart_item(selector, value, this.item_details.current_item);\n\t\t\t\t},\n\t\t\t\tclone_new_batch_item_in_frm: (batch_serial_map, item) => {\n\t\t\t\t\t// called if serial nos are 'auto_selected' and if those serial nos belongs to multiple batches\n\t\t\t\t\t// for each unique batch new item row is added in the form & cart\n\t\t\t\t\tObject.keys(batch_serial_map).forEach(batch => {\n\t\t\t\t\t\tconst item_to_clone = this.frm.doc.items.find(i => i.name == item.name);\n\t\t\t\t\t\tconst new_row = this.frm.add_child(\"items\", { ...item_to_clone });\n\t\t\t\t\t\t// update new serialno and batch\n\t\t\t\t\t\tnew_row.batch_no = batch;\n\t\t\t\t\t\tnew_row.serial_no = batch_serial_map[batch].join(`\\n`);\n\t\t\t\t\t\tnew_row.qty = batch_serial_map[batch].length;\n\t\t\t\t\t\tthis.frm.doc.items.forEach(row => {\n\t\t\t\t\t\t\tif (item.item_code === row.item_code) {\n\t\t\t\t\t\t\t\tthis.update_cart_html(row);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tremove_item_from_cart: () => this.remove_item_from_cart(),\n\t\t\t\tget_item_stock_map: () => this.item_stock_map,\n\t\t\t\tclose_item_details: () => {\n\t\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\t\tthis.cart.prev_action = null;\n\t\t\t\t\tthis.cart.toggle_item_highlight();\n\t\t\t\t},\n\t\t\t\tget_available_stock: (item_code, warehouse) => this.get_available_stock(item_code, warehouse)\n\t\t\t}\n\t\t});\n\t}\n\n\tinit_payments() {\n\t\tthis.payment = new erpnext.PointOfSale.Payment({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm || {},\n\n\t\t\t\tget_customer_details: () => this.customer_details || {},\n\n\t\t\t\ttoggle_other_sections: (show) => {\n\t\t\t\t\tif (show) {\n\t\t\t\t\t\tthis.item_details.$component.is(':visible') ? this.item_details.$component.css('display', 'none') : '';\n\t\t\t\t\t\tthis.item_selector.$component.css('display', 'none');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.item_selector.$component.css('display', 'flex');\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tsubmit_invoice: () => {\n\t\t\t\t\tthis.frm.savesubmit()\n\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\tthis.toggle_components(false);\n\t\t\t\t\t\t\tthis.order_summary.toggle_component(true);\n\t\t\t\t\t\t\tthis.order_summary.load_summary_of(this.frm.doc, true);\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\tmessage: __('POS invoice {0} created succesfully', [r.doc.name])\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tinit_recent_order_list() {\n\t\tthis.recent_order_list = new erpnext.PointOfSale.PastOrderList({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\topen_invoice_data: (name) => {\n\t\t\t\t\tfrappe.db.get_doc('POS Invoice', name).then((doc) => {\n\t\t\t\t\t\tthis.order_summary.load_summary_of(doc);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\treset_summary: () => this.order_summary.toggle_summary_placeholder(true)\n\t\t\t}\n\t\t})\n\t}\n\n\tinit_order_summary() {\n\t\tthis.order_summary = new erpnext.PointOfSale.PastOrderSummary({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tprocess_return: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.db.get_doc('POS Invoice', name).then((doc) => {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => this.make_return_invoice(doc),\n\t\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t\t]);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tedit_order: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => this.frm.refresh(name),\n\t\t\t\t\t\t() => this.frm.call('reset_mode_of_payments'),\n\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t]);\n\t\t\t\t},\n\t\t\t\tdelete_order: (name) => {\n\t\t\t\t\tfrappe.model.delete_doc(this.frm.doc.doctype, name, () => {\n\t\t\t\t\t\tthis.recent_order_list.refresh_list();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tnew_order: () => {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\ttoggle_recent_order_list(show) {\n\t\tthis.toggle_components(!show);\n\t\tthis.recent_order_list.toggle_component(show);\n\t\tthis.order_summary.toggle_component(show);\n\t}\n\n\ttoggle_components(show) {\n\t\tthis.cart.toggle_component(show);\n\t\tthis.item_selector.toggle_component(show);\n\n\t\t// do not show item details or payment if recent order is toggled off\n\t\t!show ? (this.item_details.toggle_component(false) || this.payment.toggle_component(false)) : '';\n\t}\n\n\tmake_new_invoice() {\n\t\treturn frappe.run_serially([\n\t\t\t() => frappe.dom.freeze(),\n\t\t\t() => this.make_sales_invoice_frm(),\n\t\t\t() => this.set_pos_profile_data(),\n\t\t\t() => this.set_pos_profile_status(),\n\t\t\t() => this.cart.load_invoice(),\n\t\t\t() => frappe.dom.unfreeze()\n\t\t]);\n\t}\n\n\tmake_sales_invoice_frm() {\n\t\tconst doctype = 'POS Invoice';\n\t\treturn new Promise(resolve => {\n\t\t\tif (this.frm) {\n\t\t\t\tthis.frm = this.get_new_frm(this.frm);\n\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\tthis.frm.doc.is_pos = 1\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\t\tthis.frm = this.get_new_frm();\n\t\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\t\tthis.frm.doc.is_pos = 1\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget_new_frm(_frm) {\n\t\tconst doctype = 'POS Invoice';\n\t\tconst page = $('<div>');\n\t\tconst frm = _frm || new frappe.ui.form.Form(doctype, page, false);\n\t\tconst name = frappe.model.make_new_doc_and_get_name(doctype, true);\n\t\tfrm.refresh(name);\n\n\t\treturn frm;\n\t}\n\n\tasync make_return_invoice(doc) {\n\t\tfrappe.dom.freeze();\n\t\tthis.frm = this.get_new_frm(this.frm);\n\t\tthis.frm.doc.items = [];\n\t\tconst res = await frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.make_sales_return\",\n\t\t\targs: {\n\t\t\t\t'source_name': doc.name,\n\t\t\t\t'target_doc': this.frm.doc\n\t\t\t}\n\t\t});\n\t\tfrappe.model.sync(res.message);\n\t\tawait this.set_pos_profile_data();\n\t\tfrappe.dom.unfreeze();\n\t}\n\n\tset_pos_profile_data() {\n\t\tif (this.company && !this.frm.doc.company) this.frm.doc.company = this.company;\n\t\tif (this.pos_profile && !this.frm.doc.pos_profile) this.frm.doc.pos_profile = this.pos_profile;\n\t\tif (!this.frm.doc.company) return;\n\n\t\treturn this.frm.trigger(\"set_pos_data\");\n\t}\n\n\tset_pos_profile_status() {\n\t\tthis.page.set_indicator(this.pos_profile, \"blue\");\n\t}\n\n\tasync on_cart_update(args) {\n\t\tfrappe.dom.freeze();\n\t\tlet item_row = undefined;\n\t\ttry {\n\t\t\tlet { field, value, item } = args;\n\t\t\titem_row = this.get_item_from_frm(item);\n\t\t\tconst item_row_exists = !$.isEmptyObject(item_row);\n\n\t\t\tconst from_selector = field === 'qty' && value === \"+1\";\n\t\t\tif (from_selector)\n\t\t\t\tvalue = flt(item_row.qty) + flt(value);\n\n\t\t\tif (item_row_exists) {\n\t\t\t\tif (field === 'qty')\n\t\t\t\t\tvalue = flt(value);\n\n\t\t\t\tif (['qty', 'conversion_factor'].includes(field) && value > 0 && !this.allow_negative_stock) {\n\t\t\t\t\tconst qty_needed = field === 'qty' ? value * item_row.conversion_factor : item_row.qty * value;\n\t\t\t\t\tawait this.check_stock_availability(item_row, qty_needed, this.frm.doc.set_warehouse);\n\t\t\t\t}\n\n\t\t\t\tif (this.is_current_item_being_edited(item_row) || from_selector) {\n\t\t\t\t\tawait frappe.model.set_value(item_row.doctype, item_row.name, field, value);\n\t\t\t\t\tthis.update_cart_html(item_row);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif (!this.frm.doc.customer)\n\t\t\t\t\treturn this.raise_customer_selection_alert();\n\n\t\t\t\tconst { item_code, batch_no, serial_no, rate } = item;\n\n\t\t\t\tif (!item_code)\n\t\t\t\t\treturn;\n\n\t\t\t\tconst new_item = { item_code, batch_no, rate, [field]: value };\n\n\t\t\t\tif (serial_no) {\n\t\t\t\t\tawait this.check_serial_no_availablilty(item_code, this.frm.doc.set_warehouse, serial_no);\n\t\t\t\t\tnew_item['serial_no'] = serial_no;\n\t\t\t\t}\n\n\t\t\t\tif (field === 'serial_no')\n\t\t\t\t\tnew_item['qty'] = value.split(`\\n`).length || 0;\n\n\t\t\t\titem_row = this.frm.add_child('items', new_item);\n\n\t\t\t\tif (field === 'qty' && value !== 0 && !this.allow_negative_stock)\n\t\t\t\t\tawait this.check_stock_availability(item_row, value, this.frm.doc.set_warehouse);\n\n\t\t\t\tawait this.trigger_new_item_events(item_row);\n\n\t\t\t\tthis.update_cart_html(item_row);\n\n\t\t\t\tif (this.item_details.$component.is(':visible'))\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\n\t\t\t\tif (this.check_serial_batch_selection_needed(item_row))\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\t\t\t}\n\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t} finally {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\treturn item_row;\n\t\t}\n\t}\n\n\traise_customer_selection_alert() {\n\t\tfrappe.dom.unfreeze();\n\t\tfrappe.show_alert({\n\t\t\tmessage: __('You must select a customer before adding an item.'),\n\t\t\tindicator: 'orange'\n\t\t});\n\t\tfrappe.utils.play_sound(\"error\");\n\t}\n\n\tget_item_from_frm({ name, item_code, batch_no, uom, rate }) {\n\t\tlet item_row = null;\n\t\tif (name) {\n\t\t\titem_row = this.frm.doc.items.find(i => i.name == name);\n\t\t} else {\n\t\t\t// if item is clicked twice from item selector\n\t\t\t// then \"item_code, batch_no, uom, rate\" will help in getting the exact item\n\t\t\t// to increase the qty by one\n\t\t\tconst has_batch_no = batch_no;\n\t\t\titem_row = this.frm.doc.items.find(\n\t\t\t\ti => i.item_code === item_code\n\t\t\t\t\t&& (!has_batch_no || (has_batch_no && i.batch_no === batch_no))\n\t\t\t\t\t&& (i.uom === uom)\n\t\t\t\t\t&& (i.rate == rate)\n\t\t\t);\n\t\t}\n\n\t\treturn item_row || {};\n\t}\n\n\tedit_item_details_of(item_row) {\n\t\tthis.item_details.toggle_item_details_section(item_row);\n\t}\n\n\tis_current_item_being_edited(item_row) {\n\t\treturn item_row.name == this.item_details.current_item.name;\n\t}\n\n\tupdate_cart_html(item_row, remove_item) {\n\t\tthis.cart.update_item_html(item_row, remove_item);\n\t\tthis.cart.update_totals_section(this.frm);\n\t}\n\n\tcheck_serial_batch_selection_needed(item_row) {\n\t\t// right now item details is shown for every type of item.\n\t\t// if item details is not shown for every item then this fn will be needed\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_serial_selected = !item_row.serial_no;\n\t\tconst no_batch_selected = !item_row.batch_no;\n\n\t\tif ((serialized && no_serial_selected) || (batched && no_batch_selected) ||\n\t\t\t(serialized && batched && (no_batch_selected || no_serial_selected))) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tasync trigger_new_item_events(item_row) {\n\t\tawait this.frm.script_manager.trigger('item_code', item_row.doctype, item_row.name);\n\t\tawait this.frm.script_manager.trigger('qty', item_row.doctype, item_row.name);\n\t}\n\n\tasync check_stock_availability(item_row, qty_needed, warehouse) {\n\t\tconst available_qty = (await this.get_available_stock(item_row.item_code, warehouse)).message;\n\n\t\tfrappe.dom.unfreeze();\n\t\tconst bold_item_code = item_row.item_code.bold();\n\t\tconst bold_warehouse = warehouse.bold();\n\t\tconst bold_available_qty = available_qty.toString().bold()\n\t\tif (!(available_qty > 0)) {\n\t\t\tfrappe.model.clear_doc(item_row.doctype, item_row.name);\n\t\t\tfrappe.throw({\n\t\t\t\ttitle: __(\"Not Available\"),\n\t\t\t\tmessage: __('Item Code: {0} is not available under warehouse {1}.', [bold_item_code, bold_warehouse])\n\t\t\t})\n\t\t} else if (available_qty < qty_needed) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __('Stock quantity not enough for Item Code: {0} under warehouse {1}. Available quantity {2}.', [bold_item_code, bold_warehouse, bold_available_qty]),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t}\n\t\tfrappe.dom.freeze();\n\t}\n\n\tasync check_serial_no_availablilty(item_code, warehouse, serial_no) {\n\t\tconst method = \"erpnext.stock.doctype.serial_no.serial_no.get_pos_reserved_serial_nos\";\n\t\tconst args = {filters: { item_code, warehouse }}\n\t\tconst res = await frappe.call({ method, args });\n\n\t\tif (res.message.includes(serial_no)) {\n\t\t\tfrappe.throw({\n\t\t\t\ttitle: __(\"Not Available\"),\n\t\t\t\tmessage: __('Serial No: {0} has already been transacted into another POS Invoice.', [serial_no.bold()])\n\t\t\t});\n\t\t}\n\t}\n\n\tget_available_stock(item_code, warehouse) {\n\t\tconst me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.get_stock_availability\",\n\t\t\targs: {\n\t\t\t\t'item_code': item_code,\n\t\t\t\t'warehouse': warehouse,\n\t\t\t},\n\t\t\tcallback(res) {\n\t\t\t\tif (!me.item_stock_map[item_code])\n\t\t\t\t\tme.item_stock_map[item_code] = {}\n\t\t\t\tme.item_stock_map[item_code][warehouse] = res.message;\n\t\t\t}\n\t\t});\n\t}\n\n\tupdate_item_field(value, field_or_action) {\n\t\tif (field_or_action === 'checkout') {\n\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t} else if (field_or_action === 'remove') {\n\t\t\tthis.remove_item_from_cart();\n\t\t} else {\n\t\t\tconst field_control = this.item_details[`${field_or_action}_control`];\n\t\t\tif (!field_control) return;\n\t\t\tfield_control.set_focus();\n\t\t\tvalue != \"\" && field_control.set_value(value);\n\t\t}\n\t}\n\n\tremove_item_from_cart() {\n\t\tfrappe.dom.freeze();\n\t\tconst { doctype, name, current_item } = this.item_details;\n\n\t\tfrappe.model.set_value(doctype, name, 'qty', 0)\n\t\t\t.then(() => {\n\t\t\t\tfrappe.model.clear_doc(doctype, name);\n\t\t\t\tthis.update_cart_html(current_item, true);\n\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t})\n\t\t\t.catch(e => console.log(e));\n\t}\n};\n"],"names":["this","const","res","let","onScan"],"mappings":"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"}