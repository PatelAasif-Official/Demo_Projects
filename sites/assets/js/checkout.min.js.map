{"version":3,"file":"checkout.min.js","sources":["../../../apps/frappe/frappe/public/js/integrations/razorpay.js"],"sourcesContent":["/* HOW-TO\n\nRazorpay Payment\n\n1. \tInclude checkout script in your code\n\t<script type=\"text/javascript\" src=\"/assets/js/checkout.min.js\"></script>\n\n2.\tCreate the Order controller in your backend\n\tdef get_razorpay_order(self):\n\t\tcontroller = get_payment_gateway_controller(\"Razorpay\")\n\n\t\tpayment_details = {\n\t\t\t\"amount\": 300,\n\t\t\t...\n\t\t\t\"reference_doctype\": \"Conference Participant\",\n\t\t\t\"reference_docname\": self.name,\n\t\t\t...\n\t\t\t\"receipt\": self.name\n\t\t}\n\n\t\treturn controller.create_order(**payment_details)\n\n3. \tInititate the payment in client using checkout API\n\tfunction make_payment(ticket) {\n\t\tvar options = {\n\t\t\t\"name\": \"<CHECKOUT MODAL TITLE>\",\n\t\t\t\"description\": \"<CHECKOUT MODAL DESCRIPTION>\",\n\t\t\t\"image\": \"<CHECKOUT MODAL LOGO>\",\n\t\t    \"prefill\": {\n\t\t\t\t\"name\": \"<CUSTOMER NAME>\",\n\t\t\t\t\"email\": \"<CUSTOMER EMAIL>\",\n\t\t\t\t\"contact\": \"<CUSTOMER PHONE>\"\n\t\t    },\n\t\t    \"theme\": {\n\t\t\t\t\"color\": \"<MODAL COLOR>\"\n\t\t    },\n\t\t    \"doctype\": \"<REFERENCE DOCTYPE>\",\n\t\t    \"docname\": \"<REFERENCE DOCNAME\"\n\t\t};\n\n\t\trazorpay = new frappe.checkout.razorpay(options)\n\t\trazorpay.on_open = () => {\n\t\t\t<SCRIPT TO RUN WHEN MODAL OPENS>\n\t\t}\n\t\trazorpay.on_success = () => {\n\t\t\t<SCRIPT TO RUN ON PAYMENT SUCCESS>\n\t\t}\n\t\trazorpay.on_fail = () => {\n\t\t\t<SCRIPT TO RUN ON PAYMENT FAILURE>\n\t\t}\n\t\trazorpay.init() // Creates the order and opens the modal\n\t}\n*/\n\nfrappe.provide(\"frappe.checkout\");\n\nfrappe.require('https://checkout.razorpay.com/v1/checkout.js').then(() => {\n\tfrappe.checkout.razorpay = class RazorpayCheckout {\n\t\tconstructor(opts) {\n\t\t\tObject.assign(this, opts);\n\t\t}\n\n\t\tinit() {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.get_key(),\n\t\t\t\t() => this.make_order(),\n\t\t\t\t() => this.prepare_options(),\n\t\t\t\t() => this.setup_handler(),\n\t\t\t\t() => this.show()\n\t\t\t]);\n\t\t}\n\n\t\tshow() {\n\t\t\tthis.razorpay = new Razorpay(this.options);\n\t\t\tthis.razorpay.once('ready', (response) => {\n\t\t\t\tthis.on_open && this.on_open(response);\n\t\t\t})\n\t\t\tthis.razorpay.open();\n\t\t}\n\n\t\tget_key() {\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tfrappe.call(\"frappe.integrations.doctype.razorpay_settings.razorpay_settings.get_api_key\").then(res => {\n\t\t\t\t\tthis.key = res.message;\n\t\t\t\t\tresolve(true);\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\n\t\tmake_order() {\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tfrappe.call(\"frappe.integrations.doctype.razorpay_settings.razorpay_settings.get_order\", {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\tdocname: this.docname\n\t\t\t\t}).then(res => {\n\t\t\t\t\tthis.order = res.message;\n\t\t\t\t\tresolve(true);\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\n\t\torder_success(response) {\n\t\t\tfrappe.call(\"frappe.integrations.doctype.razorpay_settings.razorpay_settings.order_payment_success\", {\n\t\t\t\tintegration_request: this.order.integration_request,\n\t\t\t\tparams: {\n\t\t\t\t\trazorpay_payment_id: response.razorpay_payment_id,\n\t\t\t\t\trazorpay_order_id: response.razorpay_order_id,\n\t\t\t\t\trazorpay_signature: response.razorpay_signature\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\torder_fail(response) {\n\t\t\tfrappe.call( \"frappe.integrations.doctype.razorpay_settings.razorpay_settings.order_payment_failure\", {\n\t\t\t\tintegration_request: this.order.integration_request,\n\t\t\t\tparams: response\n\t\t\t})\n\t\t}\n\n\t\tprepare_options() {\n\t\t\tthis.options = {\n\t\t\t\t\"key\": this.key,\n\t\t\t\t\"amount\": this.order.amount_due,\n\t\t\t\t\"currency\": this.order.currency,\n\t\t\t\t\"name\": this.name,\n\t\t\t\t\"description\": this.description,\n\t\t\t\t\"image\": this.image,\n\t\t\t\t\"order_id\": this.order.id,\n\t\t\t\t\"prefill\": this.prefill,\n\t\t\t\t\"theme\": this.theme,\n\t\t\t\t\"modal\": this.modal\n\t\t\t};\n\t\t}\n\n\t\tsetup_handler() {\n\t\t\tthis.options.handler = (response) => {\n\t\t\t\tif (response.error) {\n\t\t\t\t\tthis.order_fail(response);\n\t\t\t\t\tthis.on_fail && this.on_fail(response);\n\t\t\t\t}\n\t\t\t\telse if (response.razorpay_payment_id) {\n\t\t\t\t\tthis.order_success(response);\n\t\t\t\t\tthis.on_success && this.on_success(response);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});"],"names":["this"],"mappings":"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"}